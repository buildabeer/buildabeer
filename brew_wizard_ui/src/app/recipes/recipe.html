<app-loading *ngIf="_designer.isLoading() && !_designer.error" [message]="_designer.loading_message" ></app-loading>
<div *ngIf="_designer.error">
  <h2>Error occurred in loading, please try again.</h2>
</div>
<div class="container size-limit" *ngIf="!_designer.isLoading()">
  <div class="row d-md-none">
    <ul class="nav nav-pills nav-stacked border-left rounded colored" role="tablist">
      <li class="nav-item">
        <a class="nav-link active" title="General Details" id="pills-recipe-tab" href="#recipe-tab" data-toggle="pill" role="tab" aria-controls="recipe-tab" aria-expanded="true">
          <img src="../../assets/images/recipe.png" class="icon img-response" />
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" title="Mash Details" id="pills-malt-tab" href="#malt-tab" data-toggle="pill" role="tab" aria-controls="malt-tab" aria-expanded="true">
          <img src="../../assets/images/grain.png" class="icon img-response" />
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" title="Miscellaneous Ingredients" id="pills-misc-tab" href="#misc-tab" data-toggle="pill" role="tab" aria-controls="misc-tab" aria-expanded="true">
          <i class="fas fa-star-of-life icon img-responsive solid"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" title="Hop Details" id="pills-hop-tab" href="#hop-tab" data-toggle="pill" role="tab" aria-controls="hop-tab" aria-expanded="true">
          <img src="../../assets/images/hop.png" class="icon img-response" />
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" title="Fermentation Details" id="pills-yeast-tab" href="#yeast-tab" data-toggle="pill" role="tab" aria-controls="yeast-tab" aria-expanded="true">
          <img src="../../assets/images/yeast.png" class="icon img-response" />
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" title="Water Details" id="pills-water-tab" href="#water-tab" data-toggle="pill" role="tab" aria-controls="water-tab" aria-expanded="true">
          <img src="../../assets/images/water.png" class="icon img-response" />
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link icon-tab" title="Info and Calculations" id="pills-info-tab" href="#info-tab" data-toggle="pill" role="tab" aria-controls="info-tab" aria-expanded="true">
          <i class="fas fa-info icon img-responsive solid"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link tools-tab" title="Tools" id="pills-tools-tab" href="#tools-tab" data-toggle="pill" role="tab" aria-controls="tools-tab" aria-expanded="true">
          <i class="fas fa-wrench icon img-responsive solid"></i>
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link measurement-tab" title="Measurements" id="pills-measurement-tab" href="#measurement-tab" data-toggle="pill" role="tab" aria-controls="measurement-tab" aria-expanded="true">
          <i class="fas fa-ruler icon img-responsive solid"></i>
        </a>
      </li>
    </ul>
  </div>
  <div class="row">
    <div class="col-md-5">
      <div class="row border rounded">
        <div class="col-md-10 no-right-pad">
          <div class="tab-content">

            <div class="tab-pane fade show active" id="recipe-tab" role="tabpanel" aria-labelledby="pills-recipe-tab">
              <h3 class="underline">Recipe Settings</h3>

              <div class="container">
                <div class="row">
                  <div class="form-group">
                    <label class="switch">
                      <input type="checkbox" name="global" id="global" [(ngModel)]="_designer.recipe.global">
                      <span class="slider round"></span>
                    </label>
                    <label class="checkbox-label" for="global">Public</label>
                  </div>

                  <div class="col-12">
                    <label for="recipe-name">Recipe Name</label>
                    <input type="text" id="recipe-name" class="form-control" min="0" max="40" placeholder="Deliciauto The Great" [(ngModel)]="_designer.recipe.name">
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <label for="recipe-brewer">Brewer</label>
                    <input type="text" id="recipe-brewer" class="form-control" min="0" max="40" [(ngModel)]="_designer.recipe.brewer">
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <label for="recipe-date">Date Created</label>
                    <input type="date" id="recipe-date" class="form-control" [ngModel]="_designer.recipe.recipe_date | date:'yyyy-MM-dd'" (ngModelChange)="_designer.recipe.recipe_date = $event">
                  </div>

                  <div class="col-6">
                    <label for="recipe-version">Version</label>
                    <input type="number" id="recipe-version" step=".1" class="form-control" min="0" max="100" [(ngModel)]="_designer.recipe.version">
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <label for="recipe-style">Style</label>
                    <div class="input-group">
                      <button class="btn btn-primary" title="View style details." (click)="_designer.openDetail(styleDetailPopup)"><i class="fas fa-sticky-note"></i></button>
                      <select id="recipe-style" class="item-selector form-control" [(ngModel)]="_designer.used_style" (ngModelChange)="_designer.styleChange($event)">
                        <option *ngFor="let s of _designer.styles" [ngValue]="s">{{ s.name }} - {{ s.category_number }}</option>
                      </select>
                    </div>
                  </div>

                  <div class="col-6">
                    <span *ngIf="_designer.abs((_designer.recipe.efficiency - _designer.used_equipment.efficiency) / _designer.used_equipment.efficiency) > .1"><i title="There is currently a large disparity between the recipe efficiency and your listed equipment efficiency ({{ _designer.used_equipment.efficiency }}%)." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    <label for="mash_effic">Efficiency (%)</label>
                    <input type="number" id="mash_effic" step="1" class="form-control" min="0" max="100" (ngModelChange)="_designer.efficiencyOnChange($event)" [(ngModel)]="_designer.recipe.efficiency">
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <label for="batch-size">Batch Size ({{ (_designer.measurement.liquid === 'us' ? "gal" : "l") }})</label>
                    <input type="number" (ngModelChange)="_designer.batchSizeOnChange($event)" id="batch-size" step="0.1" class="form-control" min="0" max="{{_designer.checkGallonsToLiters(_designer.used_equipment ? _designer.used_equipment.batch_limit : 50)}}" [(ngModel)]="_designer.recipe.batch_size">
                  </div>

                  <div class="col-6">
                    <label for="recipe-boil">Boil Time (min)</label>
                    <input type="number" (ngModelChange)="_designer.waterAutoOnChange()" id="recipe-boil" step="1" class="form-control" min="0" max="180" [(ngModel)]="_designer.recipe.boil_time">
                  </div>
                </div>

                <div class="row">
                  <div class="col-6">
                    <label for="recipe_equip">Equipment</label>
                    <div class="input-group">
                      <button class="btn btn-primary" title="View equipment details." (click)="_designer.openDetail(equipmentDetailPopup)"><i class="fas fa-sticky-note"></i></button>
                      <select id="recipe_equip" (ngModelChange)="_designer.waterAutoOnChange(); _designer.hopUsageOnChange(); _designer.recipe.efficiency = _designer.used_equipment.efficiency " class="item-selector form-control" [(ngModel)]="_designer.used_equipment">
                        <option *ngFor="let e of _designer.equipment" [ngValue]="e">{{ e.name }}</option>
                      </select>
                    </div>
                  </div>

                  <div class="col-6">
                    <label for="recipe-type">Recipe Type</label>
                      <select id="recipe-type" (ngModelChange)="_designer.waterAutoOnChange();" class="item-selector form-control" [(ngModel)]="_designer.recipe.recipe_type">
                        <option>All Grain</option>
                        <option>Extract</option>
                        <option>Brew in a Bag</option>
                      </select>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <label for="notes">Notes</label>
                    <textarea class="form-control" rows="10" id="notes" name="notes" maxlength="1000" [(ngModel)]="_designer.recipe.notes"></textarea>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <label for="description">Description</label>
                    <textarea class="form-control" rows="10" id="description" name="description" maxlength="1000" [(ngModel)]="_designer.recipe.description"></textarea>
                  </div>
                </div>

                <div class="row">
                  <div class="col-12">
                    <label for="taste-notes">Taste Notes</label>
                    <textarea class="form-control" rows="10" id="taste-notes" name="taste-notes" maxlength="1000" [(ngModel)]="_designer.recipe.taste_notes"></textarea>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show" id="water-tab" role="tabpanel" aria-labelledby="pills-water-tab">
              <h3 class="underline">Water</h3>

              <div class="btn-group">
                <button class="btn btn-primary" type="button" [disabled]="_designer.water_profile_select" [ngClass]="{'disabled': _designer.water_profile_select}" (click)="_designer.water_profile_select = !_designer.water_profile_select">Target Profile</button>
                <button class="btn btn-primary" type="button" [disabled]="!_designer.water_profile_select" [ngClass]="{'disabled': !_designer.water_profile_select}" (click)="_designer.water_profile_select = !_designer.water_profile_select">Target Water</button>
              </div>

              <div *ngIf="_designer.water_profile_select">
                <div class="container">
                  <div class="row">
                    <div class="col-12">
                      <h5 class="pad-top">Target Profile</h5>
                    </div>
                  </div>
                  <div class="row pad-bottom underline">
                    <div class="col-6">
                      <div class="btn-group">
                        <button class="btn btn-primary" type="button" [disabled]="_designer.water_profile.style === 'ale'" [ngClass]="{'disabled': _designer.water_profile.style === 'ale'}" (click)="_designer.water_profile.style = 'ale'; _designer.sliderChange(_designer.water_profile)">Ale</button>
                        <button class="btn btn-primary" type="button" [disabled]="_designer.water_profile.style === 'lager'" [ngClass]="{'disabled': _designer.water_profile.style === 'lager'}" (click)="_designer.water_profile.style = 'lager'; _designer.sliderChange(_designer.water_profile)">Lager</button>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <span class="help-icon" title="The profile is based off of color ranges from: pale ({{ _designer.roundPointOne(_designer.checkColor(0)) }}-{{ _designer.roundPointOne(_designer.checkColor(9)) }} {{ _designer.measurement.color === 'srm' ? 'SRM' : 'L' }}), amber ({{ _designer.roundPointOne(_designer.checkColor(9)) }}-{{ _designer.roundPointOne(_designer.checkColor(18)) }} {{ _designer.measurement.color === 'srm' ? 'SRM' : 'L' }}), and brown/black ({{ _designer.roundPointOne(_designer.checkColor(18)) }}+ {{ _designer.measurement.color === 'srm' ? 'SRM' : 'L' }})">&#9432; </span>
                            <label for="color_slider">Color:</label>
                            <label for="color_slider">{{ _designer.water_profile.color }}</label>
                          </div>
                          <div class="col-12 slider-div">
                            <input id="color_slider" type="range" min="1" max="3" list="color_list" class="slider" [(ngModel)]="_designer.sliders.color" (ngModelChange)="_designer.sliderChange($event)" step="1">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <span class="help-icon" title="The profile is based off of strength ranges from: light (OG 30-45), medium (OG 45-65), and strong (OG 65+)">&#9432; </span>
                            <label for="strength_slider">Strength:</label>
                            <label for="strength_slider">{{ _designer.water_profile.strength }}</label>
                          </div>
                          <div class="col-12 slider-div">
                            <input id="strength_slider" type="range" min="1" max="3" class="slider" [(ngModel)]="_designer.sliders.strength" step="1" (ngModelChange)="_designer.sliderChange($event)">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <span class="help-icon" title="The profile is based off of bitterness ranges from: soft (10-20 IBUs), moderate (20-35 IBUs), and assertive (35+ IBUs)">&#9432; </span>
                            <label for="hoppiness_slider">Bitterness:</label>
                            <label for="hoppiness_slider">{{ _designer.water_profile.hoppiness }}</label>
                          </div>
                          <div class="col-12 slider-div">
                            <input id="hoppiness_slider" type="range" min="1" max="3" class="slider" [(ngModel)]="_designer.sliders.hoppiness" step="1" (ngModelChange)="_designer.sliderChange($event)">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <div class="row" *ngIf="_designer.recipe.recipe_type !== 'Extract'">
                    <div class="col-6">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <span class="help-icon" title="This is the ratio of water to grain (water/grain), usually in the range of {{ _designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts') }} to {{ _designer.checkGallonsToLiters(2, true) / _designer.checkPoundsToGrams(1, 'malts') }}">&#9432; </span>
                            <label for="grist_ratio_slider">Grist Ratio:</label>
                            <label for="grist_ratio_slider">{{ _designer.recipe.mash_ratio }} ({{ _designer.measurement.liquid === 'us' ? 'qt' : 'l' }}/{{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }})</label>
                          </div>
                          <div class="col-12 slider-div">
                            <input id="grist_ratio_slider" type="range" min="{{ _designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts') }}" max="{{ _designer.checkGallonsToLiters(2, true) / _designer.checkPoundsToGrams(1, 'malts') }}" step="0.01" class="slider" [(ngModel)]="_designer.recipe.mash_ratio" (ngModelChange)="_designer.setStrikeAmount()">
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-6">
                      <span class="help-icon" title="The quantity of water used in the mash, based off of grain used and mash ratio." *ngIf="_designer.recipe.mash_ratio >= (_designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts')) && _designer.recipe.mash_ration <= (_designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(2, 'malts'))">&#9432; </span>
                      <span *ngIf="_designer.recipe.mash_ratio < (_designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts')) || _designer.recipe.mash_ration > (_designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(2, 'malts'))"><i title="The quantity of water used in the mash, based off of grain used and mash ratio. The strike water used should result in a mash ratio between {{ _designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts') }} and {{ (_designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(2, 'malts')) }}." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                      <label for="strike_quantity">Strike Quantity ({{ _designer.measurement.liquid === 'us' ? 'qt' : 'l' }})</label>
                      <input id="strike_quantity" type="number" step="0.1" min="0" max="{{ _designer.checkGallonsToLiters(2, true) / _designer.checkPoundsToGrams(1, 'malts') * _designer.checkPoundsToGrams(_designer.getTotalGrainWeight(), 'malts')}}" [(ngModel)]="_designer.strike_amount" (ngModelChange)="_designer.strikeWaterOnChange()">
                    </div>
                  </div>
                  <div class="row pad-top">
                    <h5 class="col-8">Water Used
                      <select (change)="_designer.measurementChange('liquid')" id="liquid-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['liquid']">
                        <option value="us">(gal)</option>
                        <option value="metric">(l)</option>
                      </select>
                    </h5>
                    <div class="col-12 pad-bottom underline">
                      <div class="container">
                        <div class="row">
                          <div class="col-5">
                            <label><span class="help-icon" title="The primary water profile that you are using.">&#9432; </span> Water</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_waters[0]">
                              <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_waters[0]">
                            <label for="water_quantity">Quantity</label>
                            <input id="water_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" (ngModelChange)="_designer.waterAutoOnChange()" [(ngModel)]="_designer.recipe.recipe_waters_attributes[0].quantity">
                          </div>
                          <div class="col-3" *ngIf="_designer.used_waters[0]">
                            <div class="form-group no-pad-bottom">
                              <label class="checkbox-label" for="preboil_check"><span class="help-icon" title="This constitutes bringing the water to a boil for 30 minutes, letting it cool over night, and then decanting the water off of the white mineral substance that forms at the bottom of the container. This reduces alkalinity and calcium.">&#9432; </span> Boil</label>
                              <label class="switch">
                                <input type="checkbox" name="acidify_sparge" id="preboil_check" [(ngModel)]="_designer.recipe.recipe_waters_attributes[0].boil">
                                <span class="slider round"></span>
                              </label>
                            </div>
                          </div>
                        </div>
                        <div class="row pad-top" *ngIf="_designer.used_waters[0]">
                          <div class="col-5">
                            <label><span class="help-icon" title="Water being used to dilute your primary water source to reduce minerals and/or hardness (typically w/ RO or other purified water).">&#9432; </span> Dilution</label>


                            <select class="item-selector form-control" [(ngModel)]="_designer.add_water" (ngModelChange)="_designer.onAddWaterProfile($event); _designer.waterAutoOnChange()" *ngIf="!_designer.used_waters[1]">
                              <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                            </select>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_waters[1]" *ngIf="_designer.used_waters[1]">
                              <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_waters[1]">
                            <label for="dilution_quantity">Quantity</label>
                            <input id="water_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" (ngModelChange)="_designer.waterAutoOnChange()" [(ngModel)]="_designer.recipe.recipe_waters_attributes[1].quantity">
                          </div>
                          <div class="col-3" *ngIf="_designer.used_waters[1]">
                            <label for="dilution_percent">Total %</label>
                            <input id="dilution_percent" type="number" min="0" max="100" [(ngModel)]='_designer.used_water_ratio' (ngModelChange)="_designer.waterPercentChange()">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row pad-top">
                    <h5 class="col-8">Water Agents
                      <select (change)="_designer.measurementChange('agent')" id="agent-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['agents']">
                        <option value="us">(oz)</option>
                        <option value="metric">(g)</option>
                      </select>
                    </h5>
                    <p class="col-8">Agent Name</p>
                    <p class="col-2 text-right">Amount<!--  ({{ _designer.measurement.agents === 'us' ? "oz" : "g" }}) --></p>
                  </div>

                  <div class="row pad-bottom underline">
                    <div class="container">
                      <div class="row" *ngFor="let a of _designer.agents; let i = index ">
                        <div class="col-1 no-pad">
                           <span class="help-icon float-right" title="{{ _designer.waterAgentTitle(a) }}">&#9432; </span>
                        </div>
                        <div class="col-7 no-right-pad">
                          <p class="item-name">{{ a.name }} ({{ _designer.measurement.agents === 'us' ? "oz" : "g" }})</p>
                        </div>
                        <div class="col-3">
                          <input type="number" class="mini-element form-control" step="0.1" min="0" max="1000" [(ngModel)]="_designer.recipe.recipe_water_agents_attributes[i].quantity" (ngModelChange)="_designer.waterAutoOnChange()">
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row pad-top">
                    <span *ngIf="_designer.used_water_profile.acidify && _designer.used_acids.length === 0"><i title="It is advised that you acidify this mash." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    <h5 class="col-8">Mash Acid
                    </h5>
                    <div class="col-12 pad-bottom underline">
                      <div class="container">
                        <div class="row">
                          <div class="col-8" *ngIf="!_designer.used_acids[0]">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the mash.">&#9432; </span> Acid 1</label>
                            <select class="item-selector form-control" [(ngModel)]="_designer.add_acid" (ngModelChange)="_designer.onAddAcid($event, 'Mash')">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-8" *ngIf="_designer.used_acids[0]">
                            <label><span class="help-icon" title="{{ _designer.used_acids[0].description }}">&#9432; </span> Acid 1</label>
                            <select class="item-selector form-control" [(ngModel)]="_designer.used_acids[0]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_acids[0]">
                            <label for="acid_quantity">Quantity</label>
                            <input id="acid_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_acids_attributes[0].quantity">
                          </div>
                        </div>
                        <div class="row pad-top" *ngIf="_designer.used_acids[0]">
                          <div class="col-8" *ngIf="!_designer.used_acids[1]">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the mash.">&#9432; </span> Acid 2</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.add_acid" (ngModelChange)="_designer.onAddAcid($event, 'Mash')">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-8" *ngIf="_designer.used_acids[1]">
                            <label><span class="help-icon" title="{{ _designer.used_acids[1].description }}">&#9432; </span> Acid 2</label>
                            <select class="item-selector form-control" [(ngModel)]="_designer.used_acids[1]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_acids[1]">
                            <label for="acid2_quantity">Quantity</label>
                            <input id="acid2_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_acids_attributes[1].quantity">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>


                  <div class="row pad-top">
                    <h5 class="col-8">Sparge Acid
                    </h5>
                    <div class="col-12 pad-bottom underline">
                      <div class="container">
                        <div class="row">
                          <div class="col-8">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the sparge.">&#9432; </span> Acid 1</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.add_sparge_acid" (ngModelChange)="_designer.onAddSpargeAcid($event, 'Mash')" *ngIf="!_designer.used_sparge_acids[0]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_sparge_acids[0]" *ngIf="_designer.used_sparge_acids[0]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_sparge_acids[0]">
                            <label for="acid_quantity">Quantity</label>
                            <input id="acid_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_sparge_acids_attributes[0].quantity">
                          </div>
                        </div>
                        <div class="row pad-top" *ngIf="_designer.used_sparge_acids[0]">
                          <div class="col-8">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the sparge.">&#9432; </span> Acid 2</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.add_sparge_acid" (ngModelChange)="_designer.onAddSpargeAcid($event, 'Mash')" *ngIf="!_designer.used_sparge_acids[1]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_sparge_acids[1]" *ngIf="_designer.used_sparge_acids[1]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_sparge_acids[1]">
                            <label for="acid2_quantity">Quantity</label>
                            <input id="acid2_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_sparge_acids_attributes[1].quantity">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div *ngIf="!_designer.water_profile_select">
                <p>*Please note, it is advised to use a target profile.</p>
                <div class="container">
                  <div class="row">
                    <div class="col-12">
                      <p class="non-par">Total {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}: {{ _designer.checkGallonsToLiters(_designer.addWaterGallons()) | number:'1.0-1' }}</p>
                    </div>
                    <div class="col-10 pad-bottom">
                      <input class="form-check-input" id="matchWater" type="checkbox" value="" [(ngModel)]="_designer.match_water">
                      <label class="form-check-label" for="matchWater">
                        Automatically adjust water
                      </label>
                    </div>
                  </div>

                  <div class="row pad-top">
                    <h5 class="col-8">Water Used
                      <select (change)="_designer.measurementChange('liquid')" id="liquid-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['liquid']">
                        <option value="us">(gal)</option>
                        <option value="metric">(l)</option>
                      </select>
                    </h5>
                    <div class="col-12 pad-bottom underline">
                      <div class="container">
                        <div class="row">
                          <div class="col-5">
                            <label><span class="help-icon" title="The primary water profile that you are using.">&#9432; </span> Water</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_waters[0]">
                              <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_waters[0]">
                            <label for="water_quantity">Quantity</label>
                            <input id="water_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" (ngModelChange)="_designer.waterAutoOnChange()" [(ngModel)]="_designer.recipe.recipe_waters_attributes[0].quantity">
                          </div>
                          <div class="col-3" *ngIf="_designer.used_waters[0]">
                            <div class="form-group no-pad-bottom">
                              <label class="checkbox-label" for="preboil_check"><span class="help-icon" title="This constitutes bringing the water to a boil for 30 minutes, letting it cool over night, and then decanting the water off of the white mineral substance that forms at the bottom of the container. This reduces alkalinity and calcium.">&#9432; </span> Boil</label>
                              <label class="switch">
                                <input type="checkbox" name="acidify_sparge" id="preboil_check" [(ngModel)]="_designer.recipe.recipe_waters_attributes[0].boil">
                                <span class="slider round"></span>
                              </label>
                            </div>
                          </div>
                        </div>
                        <div class="row pad-top" *ngIf="_designer.used_waters[0]">
                          <div class="col-5">
                            <label><span class="help-icon" title="Water being used to dilute your primary water source to reduce minerals and/or hardness (typically w/ RO or other purified water).">&#9432; </span> Dilution</label>


                            <select class="item-selector form-control" [(ngModel)]="_designer.add_water" (ngModelChange)="_designer.onAddWaterProfile($event); _designer.waterAutoOnChange()" *ngIf="!_designer.used_waters[1]">
                              <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                            </select>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_waters[1]" *ngIf="_designer.used_waters[1]">
                              <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_waters[1]">
                            <label for="dilution_quantity">Quantity</label>
                            <input id="water_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" (ngModelChange)="_designer.waterAutoOnChange()" [(ngModel)]="_designer.recipe.recipe_waters_attributes[1].quantity">
                          </div>
                          <div class="col-3" *ngIf="_designer.used_waters[1]">
                            <label for="dilution_percent">Total %</label>
                            <input id="dilution_percent" type="number" min="0" max="100" [(ngModel)]='_designer.used_water_ratio' (ngModelChange)="_designer.waterPercentChange()">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="container border-bottom">
                  <div class="row pad-bottom">
                    <div class="col-12">
                      <h5>Target Water</h5>
                    </div>
                    <div class="col-1 no-pad" title="{{ _designer.waterProfileTitle(_designer.target_water) }}">
                      <button class="btn btn-primary" title="View target water details." (click)="_designer.openDetail(targetWaterDetailPopup)"><i class="fas fa-sticky-note"></i></button>
                    </div>
                    <div class="col-11">
                      <select id="addWaterDropdown" (ngModelChange)="_designer.waterAutoOnChange($event)" class="item-selector form-control" [(ngModel)]="_designer.target_water">
                        <option *ngFor="let w of _designer.waters" [ngValue]="w">{{ w.name }}</option>
                      </select>
                    </div>
                  </div>
                </div>

                <div class="container border-bottom pad-full">
                  <div class="row">
                    <div class="col-10 offset-md-1">
                      <button type="button" class="btn btn-primary match-button" (click)="_designer.matchWater()">Match Water Quantities to Target</button>
                    </div>
                    <div class="col-10 offset-md-1">
                      <button type="button" class="btn btn-primary match-button" (click)="_designer.matchAgents()">Match Water Agents to Target</button>
                    </div>
                    <div class="col-10 offset-md-1 pad-bottom">
                      <button type="button" class="btn btn-primary match-button" (click)="_designer.matchWaterAndAgents()">Match Water to Target</button>
                    </div>
                  </div>
                </div>

                <div class="container underline">
                  <div class="row">
                  </div>

                  <div class="row">
                    <h5 class="col-8">Water Agents
                      <select (change)="_designer.measurementChange('agent')" id="agent-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['agents']">
                        <option value="us">(oz)</option>
                        <option value="metric">(g)</option>
                      </select>
                    </h5>
                    <div class="col-10 pad-bottom">
                      <input class="form-check-input" id="matchAgents" type="checkbox" value="" [(ngModel)]="_designer.match_agent">
                      <label class="form-check-label" for="matchAgents">
                        Automatically adjust agents
                      </label>
                    </div>
                    <p class="col-8">Agent Name</p>
                    <p class="col-2 text-right">Amount<!--  ({{ _designer.measurement.agents === 'us' ? "oz" : "g" }}) --></p>
                  </div>

                  <div class="row" *ngFor="let a of _designer.agents; let i = index ">
                    <div class="col-1 no-pad">
                       <span class="help-icon float-right" title="{{ _designer.waterAgentTitle(a) }}">&#9432; </span>
                    </div>
                    <div class="col-7 no-right-pad">
                      <p class="item-name">{{ a.name }} ({{ _designer.measurement.agents === 'us' ? "oz" : "g" }})</p>
                    </div>
                    <div class="col-3">
                      <input type="number" [disabled]="_designer.match_agent" class="mini-element form-control" step="0.1" min="0" max="1000" [(ngModel)]="_designer.recipe.recipe_water_agents_attributes[i].quantity" (ngModelChange)="_designer.waterAutoOnChange()">
                    </div>
                  </div>
                </div>
                <div class="container">

                  <div class="row pad-top">
                    <span *ngIf="_designer.used_water_profile.acidify && _designer.used_acids.length === 0"><i title="It is advised that you acidify this mash." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    <h5 class="col-8">Mash Acid
                    </h5>
                    <div class="col-12 pad-bottom underline">
                      <div class="container">
                        <div class="row">
                          <div class="col-8" *ngIf="!_designer.used_acids[0]">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the mash.">&#9432; </span> Acid 1</label>
                            <select class="item-selector form-control" [(ngModel)]="_designer.add_acid" (ngModelChange)="_designer.onAddAcid($event, 'Mash')">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-8" *ngIf="_designer.used_acids[0]">
                            <label><span class="help-icon" title="{{ _designer.used_acids[0].description }}">&#9432; </span> Acid 1</label>
                            <select class="item-selector form-control" [(ngModel)]="_designer.used_acids[0]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_acids[0]">
                            <label for="acid_quantity">Quantity</label>
                            <input id="acid_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_acids_attributes[0].quantity">
                          </div>
                        </div>
                        <div class="row pad-top" *ngIf="_designer.used_acids[0]">
                          <div class="col-8" *ngIf="!_designer.used_acids[1]">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the mash.">&#9432; </span> Acid 2</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.add_acid" (ngModelChange)="_designer.onAddAcid($event, 'Mash')">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-8" *ngIf="_designer.used_acids[1]">
                            <label><span class="help-icon" title="{{ _designer.used_acids[1].description }}">&#9432; </span> Acid 2</label>
                            <select class="item-selector form-control" [(ngModel)]="_designer.used_acids[1]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_acids[1]">
                            <label for="acid2_quantity">Quantity</label>
                            <input id="acid2_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_acids_attributes[1].quantity">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div class="row pad-top">
                    <h5 class="col-8">Sparge Acid
                    </h5>
                    <div class="col-12 pad-bottom underline">
                      <div class="container">
                        <div class="row">
                          <div class="col-8">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the sparge.">&#9432; </span> Acid 1</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.add_sparge_acid" (ngModelChange)="_designer.onAddSpargeAcid($event, 'Mash')" *ngIf="!_designer.used_sparge_acids[0]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_sparge_acids[0]" *ngIf="_designer.used_sparge_acids[0]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_sparge_acids[0]">
                            <label for="acid_quantity">Quantity</label>
                            <input id="acid_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_sparge_acids_attributes[0].quantity">
                          </div>
                        </div>
                        <div class="row pad-top" *ngIf="_designer.used_sparge_acids[0]">
                          <div class="col-8">
                            <label><span class="help-icon" title="Acid is used to lower the pH of the sparge.">&#9432; </span> Acid 2</label>

                            <select class="item-selector form-control" [(ngModel)]="_designer.add_sparge_acid" (ngModelChange)="_designer.onAddSpargeAcid($event, 'Mash')" *ngIf="!_designer.used_sparge_acids[1]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>

                            <select class="item-selector form-control" [(ngModel)]="_designer.used_sparge_acids[1]" *ngIf="_designer.used_sparge_acids[1]">
                              <option *ngFor="let a of _designer.acids" [ngValue]="a">{{ a.name }}</option>
                            </select>
                          </div>
                          <div class="col-4" *ngIf="_designer.used_sparge_acids[1]">
                            <label for="acid2_quantity">Quantity</label>
                            <input id="acid2_quantity" type="number" step="0.1" min="0" max="1000" class="form-control" [(ngModel)]="_designer.recipe.recipe_sparge_acids_attributes[1].quantity">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show" id="malt-tab" role="tabpanel" aria-labelledby="pills-malt-tab">
              <h3 class="underline">Malt</h3>

              <div class="container">
                <div class="row">
                  <div class="col-10 pad-bottom">
                    <input class="form-check-input" id="matchMalts" type="checkbox" value="" [(ngModel)]="_designer.match_malt">
                    <label class="form-check-label" for="matchMalts">
                      Automatically adjust malts
                    </label>
                  </div>

                  <h5 class="col-7 border-bottom">Malt Used
                    <select (change)="_designer.measurementChange('malt')" id="malt-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['malts']">
                      <option value="us">(lb)</option>
                      <option value="metric">(g)</option>
                    </select>
                  </h5>
                </div>

                <div class="row pad-top border-bottom pad-bottom" *ngFor="let m of _designer.used_malts; let i = index ">
                  <div class="col-1 no-pad">
                    <button class="btn btn-primary" title="View malt details." (click)="_designer.openDetail(maltDetailPopup, i)"><i class="fas fa-sticky-note"></i></button>
                  </div>
                  <div class="col-8 no-right-pad">
                    <p class="item-name ">{{ m.name }}</p>
                  </div>
                  <div class="col-2">
                    <button class="btn btn-secondary mini-cancel float-right" (click)="_designer.removeMalt(i)">&#8854;</button>
                  </div>

                  <div class="col-4">
                    <label for="grainColor">Color ({{ _designer.getColorString() }})</label>
                    <input type="number" step="0.1" id="grainColor" class="mini-element form-control" min="0" max="999" [(ngModel)]="_designer.recipe.recipe_malts_attributes[i].color">
                  </div>
                  <div class="col-4">
                    <label for="grainQuantity">Quantity ({{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }})</label>
                    <input type="number" step="0.01" id="grainQuantity" class="mini-element form-control" min="0" max="100" [(ngModel)]="_designer.recipe.recipe_malts_attributes[i].quantity" (ngModelChange)="_designer.waterAutoOnChange()">
                  </div>
                  <div class="col-4">
                    <label for="grainUsage">Usage</label>
                    <select id="grainUsage" class="mini-element form-control" [(ngModel)]="_designer.recipe.recipe_malts_attributes[i].malt_usage" (ngModelChange)="_designer.waterAutoOnChange()">
                      <option>Mash</option>
                      <option *ngIf="_designer.recipe.recipe_type !== 'Extract'">Sparge</option>
                      <option>Boil</option>
                    </select>
                  </div>
                </div>

                <div class="row pad-bottom pad-top">
                  <div class="col-1 no-pad" title="Add Malt">
                    <p class="help-icon float-right">&#9432; </p>
                  </div>
                  <div class="col-7 no-right-pad">
                    <select id="addGrainDropdown" class="item-selector form-control" [(ngModel)]="_designer.add_malt" (ngModelChange)="_designer.onAddMalt($event)">
                      <option *ngFor="let m of _designer.malts" [ngValue]="m">{{ m.name }}</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <app-malt-select [maltOptions]="_designer.malts" [maltTypes]="_designer.maltTypes" (selectedMalt)="_designer.selectedMaltEvent($event)"></app-malt-select>
                </div>
              </div>

              <h3 class="underline pad-bottom" *ngIf="_designer.used_equipment && _designer.recipe.recipe_type !== 'Extract'">Mash</h3>

              <div class="container" *ngIf="_designer.used_equipment && _designer.recipe.recipe_type !== 'Extract'">
                <div class="row">
                  <div class="col-4 pad-top">
                    <p><span class="help-icon" title="Note: This is a ratio of ({{ _designer.measurement.liquid === 'us' ? 'qt' : 'l' }} of water / {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }} of grain). Typical ratio range is {{ _designer.roundHundredth(_designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts')) }}-{{ _designer.roundHundredth(_designer.checkGallonsToLiters(2, true) / _designer.checkPoundsToGrams(1, 'malts')) }} if doing single infusion or step mash, the typical ratio range is {{ _designer.roundHundredth(_designer.checkGallonsToLiters(2, true) / _designer.checkPoundsToGrams(1, 'malts')) }}-{{ _designer.roundHundredth(_designer.checkGallonsToLiters(3, true) / _designer.checkPoundsToGrams(1, 'malts')) }} for a decoction mash.">&#9432;</span> Mash Ratio ({{ _designer.measurement.liquid === 'us' ? 'qt' : 'l' }}/{{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}):</p>
                  </div>
                  <div class="col-4 pad-bottom">
                    <input type="number" class="form-control" id="mash_ratio" name="mash_ratio" step="0.01" min="{{ _designer.checkGallonsToLiters(1, true) / _designer.checkPoundsToGrams(1, 'malts') }}" max="{{ _designer.checkGallonsToLiters(2, true) / _designer.checkPoundsToGrams(1, 'malts') }}" [(ngModel)]="_designer.recipe.mash_ratio">
                  </div>
                  <div class="col-12 pad-bottom" *ngIf="_designer.recipe.recipe_type === 'All Grain'">
                    <span class="help-icon" title="{{_designer.getSpargeInfo()}}">&#9432; </span>
                    <label for="sparge_type">Sparge Type</label>
                    <select id="sparge_type" class="mini-element item-selector form-control" [(ngModel)]="_designer.recipe.sparge_type">
                      <option value="none">None</option>
                      <option value="batch" *ngIf="_designer.used_equipment && _designer.used_equipment.fly_sparge">Batch Sparge</option>
                      <option value="fly" *ngIf="!_designer.used_equipment || _designer.used_equipment.batch_sparge">Fly Sparge</option>
                    </select>
                  </div>
                  <div class="col-12 pad-bottom">
                    <span class="help-icon" title="{{_designer.getMashInfo()}}">&#9432; </span>
                    <label for="mash_type">Mash Type</label>
                    <select id="mash_type" class="mini-element item-selector form-control" [(ngModel)]="_designer.recipe.mash_type">
                      <option value="none">Single Infusion</option>
                      <option value="step">Step Mash</option>
                      <option value="decoction">Decoction Mash</option>
                    </select>
                  </div>
                </div>
              </div>

              <div class="container" *ngIf="_designer.infusion_step && _designer.recipe.mash_type === 'none' && _designer.recipe.recipe_type !== 'Extract'">
                <div class="row">
                  <div class="col-1">
                    <span class="help-icon" title="Suggested temperature range: 148-158&#010;Suggested time range: 45-90&#010;A single infusion mash is a single temperature range that is with alpha- and beta- amylase optimal temperature. Higher in the range favors maltier beers with more body, while lower temperatures favor beers that are cleaner with a thin body.">&#9432; </span>
                  </div>
                  <div class="col-10">
                    <p class="item-name ">Single Infusion</p>
                  </div>
                  <div class="col-6">
                    <label for="stepTemp">Temperature (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</label>
                    <input type="number" id="stepTemp" class="form-control" min="_designer.inputConversion(148, 'temperature')" max="_designer.inputConversion(158, 'temperature')" [(ngModel)]="_designer.recipe.recipe_mashes_attributes[_designer.infusion_step].temperature">
                  </div>
                  <div class="col-6">
                    <label for="stepTime">Time</label>
                    <input type="number" id="stepTime" class="form-control" min="45" max="90" [(ngModel)]="_designer.recipe.recipe_mashes_attributes[_designer.infusion_step].time">
                  </div>
                </div>
              </div>

              <div class="container" *ngIf="_designer.used_equipment && _designer.recipe.mash_type !== 'none'">
                <div class="row">
                  <h5 class="col-7 border-bottom">Mash Steps</h5>
                </div>

                <div class="row pad-top border-bottom pad-bottom" *ngFor="let step of _designer.recipe.recipe_mashes_attributes; let i = index ">
                  <div class="col-1 offset-1 float-right">
                    <input class="form-check-input" id="mash_step" type="checkbox" value="" [(ngModel)]="step.used">
                  </div>
                  <div class="col-1">
                    <span class="help-icon" title="Suggested temperature range: {{_designer.mash_steps[i].min_temp}}-{{_designer.mash_steps[i].max_temp}}&#010;Suggested time range: {{_designer.mash_steps[i].min_time}}-{{_designer.mash_steps[i].max_time}}&#010;{{ _designer.mash_steps[i].description }}">&#9432; </span>
                  </div>
                  <div class="col-9 no-right-pad">
                    <p class="item-name ">{{ step.name }}</p>
                  </div>

                  <div class="col-6" *ngIf="step.used">
                    <label for="stepTemp">Temperature (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</label>
                    <input type="number" id="stepTemp" class="form-control" min="{{_designer.inputConversion(_designer.mash_steps[i].min_temp, 'temperature')}}" max="{{_designer.inputConversion(_designer.mash_steps[i].max_temp, 'temperature')}}" [(ngModel)]="step.temperature">
                  </div>
                  <div class="col-6" *ngIf="step.used">
                    <label for="stepTime">Time</label>
                    <input type="number" id="stepTime" class="form-control" min="{{_designer.mash_steps[i].min_time}}" max="{{_designer.mash_steps[i].max_time}}" [(ngModel)]="step.time">
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show" id="misc-tab" role="tabpanel" aria-labelledby="pills-misc-tab">
              <h3 class="underline">Miscellaneous Ingredients</h3>

              <div class="container">
                <div class="row">
                  <div class="col-10 pad-bottom">
                    <input class="form-check-input" id="matchMiscs" type="checkbox" value="" [(ngModel)]="_designer.match_misc">
                    <label class="form-check-label" for="matchMiscs">
                      Automatically adjust miscellaneous
                    </label>
                  </div>

                  <h5 class="col-7 border-bottom">Miscellaneous Ingredients</h5>
                </div>

                <div class="row pad-top border-bottom pad-bottom" *ngFor="let misc of _designer.used_miscellaneous; let i = index ">
                  <div class="col-1 no-pad">
                    <button class="btn btn-primary" title="View miscellaneous details." (click)="_designer.openDetail(miscDetailPopup, i)"><i class="fas fa-sticky-note"></i></button>
                  </div>
                  <div class="col-8 no-right-pad">
                    <p class="item-name ">{{ misc.name }}</p>
                  </div>
                  <div class="col-2">
                    <button class="btn btn-secondary mini-cancel float-right" (click)="_designer.removeMiscellaneous(i)">&#8854;</button>
                  </div>

                  <div class="col-6">
                    <label for="miscQuantity">Quantity</label>
                    <input type="number" step="0.01" id="miscQuantity" class="mini-element form-control" min="0" max="100" [(ngModel)]="_designer.recipe.recipe_miscellaneous_attributes[i].quantity">
                  </div>
                  <div class="col-6">
                    <label for="miscQuantity">Quantity Units</label>
                    <input type="text" id="miscQuantityUnitLabel" class="mini-element form-control" required [(ngModel)]="_designer.recipe.recipe_miscellaneous_attributes[i].quantity_label">
                  </div>

                  <div class="col-6">
                    <label for="miscTime">Time Added</label>
                    <input type="number" step=".01" id="miscTime" class="mini-element form-control" min="0" max="100" [(ngModel)]="_designer.recipe.recipe_miscellaneous_attributes[i].time">
                  </div>
                  <div class="col-6">
                    <label for="miscTimeLabel">Time Units</label>
                    <select id="miscTimeLabel" class="mini-element item-selector form-control" [(ngModel)]="_designer.recipe.recipe_miscellaneous_attributes[i].time_label">
                      <option>Minutes</option>
                      <option>Hours</option>
                      <option>Days</option>
                    </select>
                  </div>

                  <div class="col-6">
                    <label for="miscUsage">Usage</label>
                    <select id="miscUsage" class="mini-element item-selector form-control" [(ngModel)]="_designer.recipe.recipe_miscellaneous_attributes[i].usage">
                      <option>Mash</option>
                      <option>Boil</option>
                      <option>Primary</option>
                      <option>Secondary</option>
                      <option>Bottling</option>
                    </select>
                  </div>
                </div>

                <div class="row pad-bottom pad-top">
                  <div class="col-1 no-pad" title="Add Miscellaneous Ingredients">
                    <p class="help-icon float-right">&#9432; </p>
                  </div>
                  <div class="col-7 no-right-pad">
                    <select id="addMiscDropdown" class="item-selector form-control" [(ngModel)]="_designer.add_misc" (ngModelChange)="_designer.onAddMiscellaneous($event)">
                      <option *ngFor="let misc of _designer.miscellaneous" [ngValue]="misc">{{ misc.name }}</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <app-miscellaneous-select [miscellaneousOptions]="_designer.miscellaneous" (selectedMiscellaneous)="_designer.selectedMiscellaneousEvent($event)"></app-miscellaneous-select>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show" id="hop-tab" role="tabpanel" aria-labelledby="pills-hop-tab">
              <h3 class="underline">Hops</h3>

              <div class="container">
                <div class="row">
                  <div class="col-10 pad-bottom">
                    <input class="form-check-input" id="matchHops" type="checkbox" value="" [(ngModel)]="_designer.match_hop">
                    <label class="form-check-label" for="matchHops">
                      Automatically adjust hops
                    </label>
                  </div>

                  <h5 class="col-7 border-bottom">Hops Used
                    <select (change)="_designer.measurementChange('hop')" id="hop-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['hops']">
                      <option value="us">(oz)</option>
                      <option value="metric">(g)</option>
                    </select>
                  </h5>
                </div>

                <div class="row pad-top border-bottom pad-bottom" *ngFor="let h of _designer.used_hops; let i = index ">
                  <div class="col-1 no-pad">
                    <button class="btn btn-primary" title="View hop details." (click)="_designer.openDetail(hopDetailPopup, i)"><i class="fas fa-sticky-note"></i></button>
                  </div>
                  <div class="col-8 no-right-pad">
                    <p class="item-name ">{{ h.name }}</p>
                  </div>
                  <div class="col-2">
                    <div class="btn-group float-right">
                      <button title="Substitute" class="btn btn-secondary mini-substitute dropdown-toggle" type="button" id="substituteButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" *ngIf="!h.hop_relations || !h.hop_relations.empty">
                        <i class="fas fa-retweet img-responsive"></i>
                      </button>
                      <div class="dropdown-menu" aria-labelledby="substituteButton">
                        <a type="button" class="dropdown-item" *ngFor="let sub of _designer.getHopSubstitutes(h.hop_relations ? h.hop_relations : [])" (click)="_designer.substituteHop(i, sub)">{{ sub.name }}</a>
                      </div>
                      <button title="Remove" class="btn btn-secondary mini-cancel" (click)="_designer.removeHop(i)">&#8854;</button>
                    </div>
                  </div>

                  <div class="col-6">
                    <label for="hopAlpha">Alpha (%)</label>
                    <input type="number" step="0.01" id="hopAlpha" class="mini-element form-control" min="0" max="999" [(ngModel)]="_designer.recipe.recipe_hops_attributes[i].alpha">
                  </div>
                  <div class="col-6">
                    <label for="hopQuantity">Quantity ({{ _designer.measurement.hops === 'us' ? "oz" : "g" }})</label>
                    <input type="number" step="0.01" id="hopQuantity" class="mini-element form-control" min="0" max="100" [(ngModel)]="_designer.recipe.recipe_hops_attributes[i].quantity">
                  </div>
                  <div class="col-6" *ngIf="_designer.recipe.recipe_hops_attributes[i].usage === 'dryhop' || _designer.recipe.recipe_hops_attributes[i].usage === 'boil'">
                    <label for="hopTime" *ngIf="_designer.recipe.recipe_hops_attributes[i].usage !== 'dryhop'">Time Added</label>
                    <label for="hopTime" *ngIf="_designer.recipe.recipe_hops_attributes[i].usage === 'dryhop'">Days Used</label>
                    <input type="number" step="1" id="hopTime" class="mini-element form-control" min="0" max="{{ (_designer.recipe.recipe_hops_attributes[i].usage !== 'dryhop') ? _designer.recipe.boil_time : 30 }}" [(ngModel)]="_designer.recipe.recipe_hops_attributes[i].time">
                  </div>
                  <div class="col-6">
                    <label for="hopForm">Form</label>
                    <select id="hopForm" class="mini-element item-selector form-control" [(ngModel)]="_designer.recipe.recipe_hops_attributes[i].form">
                      <option>Pellet</option>
                      <option>Whole/Plug</option>
                    </select>
                  </div>
                  <div class="col-6">
                    <span *ngIf="_designer.recipe.sparge_type === 'none' && _designer.recipe.recipe_hops_attributes[i].usage === 'fwh'"><i title="You currently have no sparge step during which to add first wort hops." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    <label for="hopForm">Usage</label>
                    <select id="hopForm" class="mini-element item-selector form-control" [(ngModel)]="_designer.recipe.recipe_hops_attributes[i].usage">
                      <option value="boil">Boil</option>
                      <option value="fwh" [disabled]="_designer.recipe.sparge_type === 'none'">First Wort (FWH)</option>
                      <option value="knockout">Knockout</option>
                      <option value="hopback" *ngIf="_designer.used_equipment && _designer.used_equipment.hop_back">Hop Back</option>
                      <option value="whirlpool" *ngIf="_designer.used_equipment && _designer.used_equipment.whirlpool">Whirlpool</option>
                      <option value="dryhop">Dry Hop</option>
                    </select>
                  </div>
                </div>

                <div class="row pad-bottom pad-top">
                  <div class="col-1 no-pad" title="Add Hops">
                    <p class="help-icon float-right">&#9432; </p>
                  </div>
                  <div class="col-7 no-right-pad">
                    <select id="addHopDropdown" class="item-selector form-control" [(ngModel)]="_designer.add_hop" (ngModelChange)="_designer.onAddHop($event)">
                      <option *ngFor="let h of _designer.hops" [ngValue]="h">{{ h.name }}</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <app-hop-select [hopOptions]="_designer.hops" (selectedHop)="_designer.selectedHopEvent($event)"></app-hop-select>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show" id="yeast-tab" role="tabpanel" aria-labelledby="pills-yeast-tab">
              <h3 class="underline">Yeast</h3>

              <div class="container">
                <div class="row">
                  <div class="col-10 pad-bottom">
                    <input class="form-check-input" id="matchYeast" type="checkbox" value="" [(ngModel)]="_designer.match_yeast">
                    <label class="form-check-label" for="matchYeast">
                      Automatically adjust yeast
                    </label>
                  </div>

                  <h5 class="col-12 border-bottom">Yeast Used - Primary Fermentation</h5>
                </div>

                <div class="row pad-bottom">
                  <div class="col-6">
                    <span *ngIf="!_designer.optimalYeastTemperatureCheck(1)"><i title="{{_designer.optimalYeastTemperatureMessage(1)}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    <label for="primaryTemp">Temperature
                      <select (change)="_designer.measurementChange('temperature')" id="temperature-measurement" class="tiny-element" [(ngModel)]="_designer.measurement.temperature">
                        <option value="us">(&deg;F)</option>
                        <option value="metric">(&deg;C)</option>
                      </select>
                    </label>
                    <input type="number" id="primaryTemp" class="mini-element form-control" min="_designer.inputConversion(33, 'temperature')" max="_designer.inputConversion(124, 'temperature')" [(ngModel)]="_designer.recipe.primary_ferm_temp">
                  </div>
                  <div class="col-6">
                    <label for="secondaryTime">Days</label>
                    <input type="number" id="primaryTime" class="mini-element form-control" min="0" [(ngModel)]="_designer.recipe.primary_ferm_days">
                  </div>
                </div>

                <div class="row">
                  <p class="col-6 offset-1">Yeast Name</p>
                  <p class="col-5 float-right"># Pkgs</p>
                </div>

                <div class="row" *ngFor="let y of _designer.used_yeast; let i = index ">
                  <div class="col-1 no-pad" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1">
                    <button class="btn btn-primary" title="View yeast details." (click)="_designer.openDetail(yeastDetailPopup, i)"><i class="fas fa-sticky-note"></i></button>
                  </div>
                  <div class="col-5 no-right-pad" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1">
                    <p class="item-name ">{{ y.name }}</p>
                  </div>
                  <div class="col-3" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1">
                    <input type="number" step="0.01" id="yeastQuantity" class="extra-mini-element form-control" min="0" max="100" [(ngModel)]="_designer.recipe.recipe_yeasts_attributes[i].quantity">
                  </div>
                  <div class="col-3" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1">
                    <div class="btn-group float-right">
                      <button title="Substitute" class="btn btn-secondary mini-substitute dropdown-toggle" type="button" id="yeastSubstituteButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" *ngIf="!y.yeast_relations || !y.yeast_relations.empty">
                        <i class="fas fa-retweet img-responsive"></i>
                      </button>
                      <div class="dropdown-menu" aria-labelledby="yeastSubstituteButton">
                        <a type="button" class="dropdown-item" *ngFor="let sub of _designer.getYeastSubstitutes(y.yeast_relations ? y.yeast_relations : [])" (click)="_designer.substituteYeast(i, sub)">{{ sub.name }}</a>
                      </div>
                      <div >
                        <button class="btn btn-secondary mini-cancel" (click)="_designer.removeYeast(y)">&#8854;</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row pad-bottom pad-top">
                  <div class="col-1 no-pad" title="Add Yeast">
                    <p class="help-icon float-right">&#9432; </p>
                  </div>
                  <div class="col-7 no-right-pad">
                    <select id="addGrainDropdown" class="item-selector form-control" [(ngModel)]="_designer.add_yeast" (ngModelChange)="_designer.onAddYeast($event, 1)">
                      <option *ngFor="let y of _designer.yeast" [ngValue]="y">{{ y.name }}</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <app-yeast-select [yeastOptions]="_designer.yeast" [styleId]="_designer.used_style ? _designer.used_style.id : _designer.styles[0]" (selectedYeast)="_designer.selectedYeastEvent($event, 1)"></app-yeast-select>
                </div>
              </div>
              <div class="container">
                <div class="row">
                  <h5 class="col-12 border-bottom pad-top">Secondary Fermentation</h5>
                  <div class="form-group">
                    <label class="switch">
                      <input type="checkbox" name="secondary_ferm" id="secondary_ferm" [(ngModel)]="_designer.recipe.secondary_fermentation">
                      <span class="slider round"></span>
                    </label>
                    <label class="checkbox-label" for="secondary_ferm">Use Secondary</label>
                  </div>
                </div>
              </div>
              <div class="container" *ngIf="_designer.recipe.secondary_fermentation">
                <div class="row pad-bottom">
                  <div class="col-6">
                    <span *ngIf="!_designer.optimalYeastTemperatureCheck(2)"><i title="{{_designer.optimalYeastTemperatureMessage(2)}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    <label for="secondaryTemp">Temperature (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</label>
                    <input type="number" id="secondaryTemp" class="mini-element form-control" min="_designer.inputConversion(33, 'temperature')" max="_designer.inputConversion(124, 'temperature')" [(ngModel)]="_designer.recipe.secondary_ferm_temp">
                  </div>
                  <div class="col-6">
                    <label for="secondaryTime">Days</label>
                    <input type="number" id="secondaryTime" class="mini-element form-control" min="0" [(ngModel)]="_designer.recipe.secondary_ferm_days">
                  </div>
                </div>

                <div class="row">
                  <p class="col-6 offset-1">Yeast Name</p>
                  <p class="col-5 float-right"># Pkgs</p>
                </div>

                <div class="row" *ngFor="let y of _designer.used_yeast; let i = index ">
                  <div class="col-1 no-pad" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 2">
                    <button class="btn btn-primary" title="View yeast details." (click)="_designer.openDetail(yeastDetailPopup, i)"><i class="fas fa-sticky-note"></i></button>
                  </div>
                  <div class="col-5 no-right-pad" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 2">
                    <p class="item-name ">{{ y.name }}</p>
                  </div>
                  <div class="col-3" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 2">
                    <input type="number" step="0.01" id="yeastQuantity" class="extra-mini-element form-control" min="0" max="100" [(ngModel)]="_designer.recipe.recipe_yeasts_attributes[i].quantity">
                  </div>
                  <div class="col-3" *ngIf="_designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 2">
                    <div class="btn-group float-right">
                      <button title="Substitute" class="btn btn-secondary mini-substitute dropdown-toggle" type="button" id="yeastSubstituteButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" *ngIf="!y.yeast_relations || !y.yeast_relations.empty">
                        <i class="fas fa-retweet img-responsive"></i>
                      </button>
                      <div class="dropdown-menu" aria-labelledby="yeastSubstituteButton">
                        <a type="button" class="dropdown-item" *ngFor="let sub of _designer.getYeastSubstitutes(y.yeast_relations ? y.yeast_relations : [])" (click)="_designer.substituteYeast(i, sub)">{{ sub.name }}</a>
                      </div>
                      <div>
                        <button class="btn btn-secondary mini-cancel" (click)="_designer.removeYeast(y)">&#8854;</button>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="row pad-bottom pad-top">
                  <div class="col-1 no-pad" title="Add Yeast">
                    <p class="help-icon float-right">&#9432; </p>
                  </div>
                  <div class="col-7 no-right-pad">
                    <select id="addGrainDropdown" class="item-selector form-control" [(ngModel)]="_designer.add_yeast" (ngModelChange)="_designer.onAddYeast($event, 2)">
                      <option *ngFor="let y of _designer.yeast" [ngValue]="y">{{ y.name }}</option>
                    </select>
                  </div>
                </div>

                <div class="row">
                  <app-yeast-select [yeastOptions]="_designer.yeast" [styleId]="_designer.used_style ? _designer.used_style.id : _designer.styles[0]" (selectedYeast)="_designer.selectedYeastEvent($event, 2)"></app-yeast-select>
                </div>
              </div>

              <h3 class="underline">Carbonation</h3>

              <div class="container">
                <div class="row">
                  <h5 class="col-10 border-bottom">Carbonation Strategy</h5>
                </div>

                <div class="row">
                  <div class="col-8">
                    <label for="storage">Storage</label>
                    <select id="storage" class="item-selector form-control" [(ngModel)]="_designer.recipe.storage_type">
                      <option value="bottle">Bottle</option>
                      <option value="keg">Keg</option>
                    </select>
                  </div>
                  <div class="col-4">
                    <label for="carbTemperature">Temperature (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</label>
                    <input type="number" id="carbTemperature" class="form-control" min="_designer.inputConversion(33)" max="_designer.inputConversion(124)" [(ngModel)]="_designer.recipe.storage_temperature">
                  </div>
                </div>

                <div class="row">
                  <div class="col-8">
                    <label for="storage"><span class="help-icon" title="{{_designer.getCarbonationWithDescription()}}">&#9432; </span>Carbonate with</label>
                    <select id="storage" class="item-selector form-control" [(ngModel)]="_designer.recipe.carbonation_with">
                      <option *ngIf="_designer.recipe.storage_type === 'keg'" value="pressure">Keg Pressure</option>
                      <option value="cornsugar">Corn Sugar</option>
                      <option value="dme">Dried Malt Extract</option>
                      <option value="honey">Honey</option>
                      <option value="tablesugar">Table Sugar</option>
                      <option value="gyle">Gyle</option>
                    </select>
                  </div>
                  <div class="col-4">
                    <label for="targetVolumes"><span *ngIf="_designer.used_style && (_designer.recipe.carbonation_volumes > _designer.used_style.max_carb || _designer.recipe.carbonation_volumes < _designer.used_style.min_carb)"><i title="The expected carbonation volumes for this style is between {{ _designer.used_style.min_carb }} and {{ _designer.used_style.max_carb }}." class="fas fa-exclamation-triangle img-responsive warning"></i></span>Volumes</label>
                    <input type="number" step="0.1" id="targetVolumes" class="form-control" min="0" max="99.9" [(ngModel)]="_designer.recipe.carbonation_volumes">
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show d-md-none" id="info-tab" role="tabpanel" aria-labelledby="pills-info-tab">
              <h3 class="underline">Recipe Figures</h3>

              <div class="container">
                <div class="row">
                  <div class="container no-pad">

                    <div class="card col-12 no-pad pad-top">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <p *ngIf="_designer.used_style">
                              <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#styleCollapse" aria-expanded="true" aria-controls="styleCollapse" (click)="style_collapse=!style_collapse">{{ !style_collapse ? '+' : '-' }}
                              </button>
                              <b>Style Proximity: {{ _designer.used_style.name }}</b>
                            </p>
                            <p *ngIf="!_designer.used_style">
                              <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#styleCollapse" aria-expanded="true" aria-controls="styleCollapse" (click)="style_collapse=!style_collapse">{{ !style_collapse ? '+' : '-' }}
                              </button>
                              <b>Style Proximity: None Selected</b>
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="container collapse show" id="styleCollapse">
                        <div class="row">
                          <div class="col-9">
                            <table class="table table-sm table-hover">
                              <tr>
                                <th></th>
                                <th>Current</th>
                                <th *ngIf="_designer.used_style"></th>
                                <th *ngIf="_designer.used_style">Style</th>
                              </tr>

                              <tr>
                                <th>Original Gravity</th>
                                <td>{{ _designer.getEstimatedOG() | number:'1.1-3' }}</td>
                                <td *ngIf="_designer.used_style && _designer.getEstimatedOG() >= _designer.used_style.min_og && _designer.getEstimatedOG() <= _designer.used_style.max_og"><i class="fas fa-check correct"></i></td>
                                <td *ngIf="_designer.used_style && (_designer.getEstimatedOG() < _designer.used_style.min_og || _designer.getEstimatedOG() > _designer.used_style.max_og)"><i class="fas fa-times-circle error"></i></td>
                                <td *ngIf="_designer.used_style">{{ _designer.used_style.min_og }} - {{ _designer.used_style.max_og }}</td>
                              </tr>

                              <tr>
                                <th>Bitterness (IBU)
                                  <div>
                                    <span class="help-icon" title="{{ _designer.getIbuMethodText() }}">&#9432; </span>
                                    <select id="ibu-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['ibu']">
                                      <option value="tinseth">Tinseth</option>
                                      <option value="rager">Rager</option>
                                      <option value="garetz">Garetz</option>
                                      <option value="daniels">Daniels</option>
                                      <option value="average">Average</option>
                                    </select>
                                  </div>
                                </th>
                                <td>{{ _designer.calculateIBU(_designer.measurement.ibu) | number:'1.1-1' }}</td>
                                <td *ngIf="_designer.used_style && _designer.calculateIBU(_designer.measurement.ibu) >= _designer.used_style.min_ibu && _designer.calculateIBU(_designer.measurement.ibu) <= _designer.used_style.max_ibu"><i class="fas fa-check correct"></i></td>
                                <td *ngIf="_designer.used_style && (_designer.calculateIBU(_designer.measurement.ibu) < _designer.used_style.min_ibu || _designer.calculateIBU(_designer.measurement.ibu) > _designer.used_style.max_ibu)"><i class="fas fa-times-circle error"></i></td>
                                <td *ngIf="_designer.used_style"> {{ _designer.used_style.min_ibu }} - {{ _designer.used_style.max_ibu }}</td>
                              </tr>

                              <tr>
                                <th>Color (
                                  <select (ngModelChange)="_designer.measurementChange('color', $event)" id="color-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['color']">
                                    <option value="srm">SRM</option>
                                    <option value="lovibond">L</option>
                                    <option value="ebc">EBC</option>
                                  </select>)
                                </th>
                                <td>{{ _designer.getBeerColorValue() | number:'1.1-1'}}</td>
                                <td *ngIf="_designer.used_style && _designer.getBeerColorValue() >= _designer.checkColor(_designer.used_style.min_color) && _designer.getBeerColorValue() <= _designer.checkColor(_designer.used_style.max_color)"><i class="fas fa-check correct"></i></td>
                                <td *ngIf="_designer.used_style && (_designer.getBeerColorValue() < _designer.checkColor(_designer.used_style.min_color) || _designer.getBeerColorValue() > _designer.checkColor(_designer.used_style.max_color))"><i class="fas fa-times-circle error"></i></td>
                                <td *ngIf="_designer.used_style">{{ _designer.checkColor(_designer.used_style.min_color) | number:'1.0-2' }} - {{ _designer.checkColor(_designer.used_style.max_color) | number:'1.0-2' }}</td>
                              </tr>

                              <tr>
                                <th>Final Gravity (%)</th>
                                <td>{{ _designer.getEstimatedFG() | number:'1.1-3' }}</td>
                                <td *ngIf="_designer.used_style && _designer.getEstimatedFG() >= _designer.used_style.min_fg && _designer.getEstimatedFG() <= _designer.used_style.max_fg"><i class="fas fa-check correct"></i></td>
                                <td *ngIf="_designer.used_style && (_designer.getEstimatedFG() < _designer.used_style.min_fg || _designer.getEstimatedFG() > _designer.used_style.max_fg)"><i class="fas fa-times-circle error"></i></td>
                                <td *ngIf="_designer.used_style">{{ _designer.used_style.min_fg }} - {{ _designer.used_style.max_fg }}</td>
                              </tr>

                              <tr>
                                <th>ABV (%)</th>
                                <td>{{ _designer.getEstimatedABV() | number:'1.0-1' }}</td>
                                <td *ngIf="_designer.used_style && _designer.getEstimatedABV() >= _designer.used_style.min_abv && _designer.getEstimatedABV() <= _designer.used_style.max_abv"><i class="fas fa-check correct"></i></td>
                                <td *ngIf="_designer.used_style && (_designer.getEstimatedABV() < _designer.used_style.min_abv || _designer.getEstimatedABV() > _designer.used_style.max_abv)"><i class="fas fa-times-circle error"></i></td>
                                <td *ngIf="_designer.used_style">{{ _designer.used_style.min_abv }} - {{ _designer.used_style.max_abv }}</td>
                              </tr>

                            </table>
                          </div>
                          <div class="col-3">
                            <img class="beer-glass" src="../../assets/images/empty_glass2.png" [ngStyle]="{'background-color': _designer.getBeerColor()}">
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <span class="help-icon" title="Note: The ratio here is calculated using raw, unrounded numbers for the purpose of accuracy.">&#9432; </span>
                            <span>Bitterness ratio: {{ _designer.calculateIBU(_designer.measurement.ibu) / (_designer.getEstimatedOG() - 1) / 1000 | number:'1.0-3' }} IBU/SG</span>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card col-12 no-pad pad-top">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <p>
                              <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#waterCollapse2" aria-expanded="true" aria-controls="waterCollapse2" (click)="water_collapse=!water_collapse">{{ !water_collapse ? '+' : '-' }}
                              </button>
                              <b>Water Profile</b>
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="container collapse show" id="waterCollapse2">
                        <div class="row">
                          <p class="col-12">Batch size: {{ _designer.recipe.batch_size| number:'1.0-1' }} {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}</p>
                          <p class="col-12">Estimated {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }} required: {{ _designer.checkGallonsToLiters(_designer.estimateGallonsNeeded()) | number:'1.0-1' }}</p>
                          <p class="col-12">Estimated pre-boil volume: {{ _designer.checkGallonsToLiters(_designer.estimatePreGallons()) | number:'1.0-1' }}</p>
                        </div>

                        <div class="row">
                          <table class="table table-sm table-hover">
                            <tr *ngIf="_designer.water_profile_select && _designer.currentWater() && _designer.used_water_profile">
                              <th class="text-center"><span class="help-icon" title="{{_designer.agentTitle('main')}}">&#9432; </span></th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('ph')" class="help-icon" title="{{_designer.agentTitle('ph')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('ph')"><i title="{{_designer.agentTitle('ph')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                pH
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.currentWater().calcium >= _designer.used_water_profile.calcium_min && _designer.currentWater().calcium <= _designer.used_water_profile.calcium_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.calcium_min }} and {{ _designer.used_water_profile.calcium_max }} ppm.">&#9432; </span>
                                <span *ngIf="_designer.currentWater().calcium > _designer.used_water_profile.calcium_max || _designer.currentWater().calcium < _designer.used_water_profile.calcium_min"><i title="{{_designer.agentTitle('ca')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Ca
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.currentWater().magnesium >= _designer.used_water_profile.magnesium_min && _designer.currentWater().magnesium <= _designer.used_water_profile.magnesium_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.magnesium_min }} and {{ _designer.used_water_profile.magnesium_max }} ppm.">&#9432; </span>
                                <span *ngIf="_designer.currentWater().magnesium > _designer.used_water_profile.magnesium_max || _designer.currentWater().magnesium < _designer.used_water_profile.magnesium_min"><i title="{{_designer.agentTitle('mg')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Mg
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.currentWater().sodium >= 0 && _designer.currentWater().sodium <= 150" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between 0 and 150 ppm.">&#9432; </span>
                                <span *ngIf="_designer.currentWater().sodium > 150 || _designer.currentWater().sodium < 0"><i title="{{_designer.agentTitle('na')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Na
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.currentWater().sulfate >= _designer.used_water_profile.sulfate_min && _designer.currentWater().sulfate <= _designer.used_water_profile.sulfate_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.sulfate_min }} and {{ _designer.used_water_profile.sulfate_max }} ppm.">&#9432; </span>
                                <span *ngIf="_designer.currentWater().sulfate > _designer.used_water_profile.sulfate_max || _designer.currentWater().sulfate < _designer.used_water_profile.sulfate_min"><i title="{{_designer.agentTitle('so4')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                SO4
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.currentWater().chloride >= _designer.used_water_profile.chloride_min && _designer.currentWater().chloride <= _designer.used_water_profile.chloride_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.chloride_min }} and {{ _designer.used_water_profile.chloride_max }} ppm.">&#9432; </span>
                                <span *ngIf="_designer.currentWater().chloride > _designer.used_water_profile.chloride_max || _designer.currentWater().chloride < _designer.used_water_profile.chloride_min"><i title="{{_designer.agentTitle('cl')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Cl
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.currentWater().bicarbonate >= _designer.used_water_profile.alkalinity_min && _designer.currentWater().bicarbonate <= _designer.used_water_profile.alkalinity_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.alkalinity_min }} and {{ _designer.used_water_profile.alkalinity_max }} ppm.">&#9432; </span>
                                <span *ngIf="_designer.currentWater().bicarbonate > _designer.used_water_profile.alkalinity_max || _designer.currentWater().bicarbonate < _designer.used_water_profile.alkalinity_min"><i title="{{_designer.agentTitle('hco3')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                HCO3
                              </th>
                            </tr>
                            <tr *ngIf="!_designer.water_profile_select">
                              <th class="text-center"><span class="help-icon" title="{{_designer.agentTitle('main')}}">&#9432; </span></th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('ph')" class="help-icon" title="{{_designer.agentTitle('ph')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('ph')"><i title="{{_designer.agentTitle('ph')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                pH
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('ca')" class="help-icon" title="{{_designer.agentTitle('ca')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('ca')"><i title="{{_designer.agentTitle('ca')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Ca
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('mg')" class="help-icon" title="{{_designer.agentTitle('mg')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('mg')" [ngClass]="{'error': (_designer.currentWater() && _designer.currentWater().magnesium >= 125), 'warning': (_designer.currentWater() && _designer.currentWater().magnesium < 125)}"><i title="{{_designer.agentTitle('mg')}}" class="fas fa-exclamation-triangle img-responsive"></i></span>
                                Mg
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('na')" class="help-icon" title="{{_designer.agentTitle('na')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('na')"><i title="{{_designer.agentTitle('na')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Na
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('so4')" class="help-icon" title="{{_designer.agentTitle('so4')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('so4')"><i title="{{_designer.agentTitle('so4')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                SO4
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('cl')" class="help-icon" title="{{_designer.agentTitle('cl')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('cl')"><i title="{{_designer.agentTitle('cl')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                Cl
                              </th>
                              <th class="text-right">
                                <span *ngIf="_designer.agentPortion('hco3')" class="help-icon" title="{{_designer.agentTitle('hco3')}}">&#9432; </span>
                                <span *ngIf="!_designer.agentPortion('hco3')"><i title="{{_designer.agentTitle('hco3')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                HCO3
                              </th>
                            </tr>
                            <tr>
                              <td>Current Water</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().ph.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().calcium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().magnesium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().sodium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().sulfate.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().chloride.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().bicarbonate.toFixed(1) : '--'}}</td>
                            </tr>
                            <tr *ngIf="!_designer.water_profile_select">
                              <td>Target Water</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.ph.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.calcium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.magnesium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.sodium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.sulfate.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.chloride.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.target_water ? _designer.target_water.bicarbonate.toFixed(1) : '--'}}</td>
                            </tr>
                            <tr class="difference" *ngIf="!_designer.water_profile_select">
                              <td>Difference</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().ph.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().calcium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().magnesium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().sodium.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().sulfate.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().chloride.toFixed(1) : '--'}}</td>
                              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().bicarbonate.toFixed(1) : '--'}}</td>
                            </tr>
                          </table>
                        </div>

                        <div class="row" *ngIf="_designer.used_water_profile && _designer.used_waters[0] && _designer.water_profile_select">
                          <app-radar-chart [canvas_id]="'profileChartMini'" [boundary]="_designer.used_water_profile" [current_water]="_designer.currentWater()"></app-radar-chart>
                        </div>
                        <div class="row">

                          <div class="col-4" *ngIf="!_designer.water_profile_select">
                            <div class="container">
                              <div class="row">
                                <div class="col-12">

                                  <span *ngIf="_designer.ra >= -60 && _designer.ra <= 200" class="help-icon" title="RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200.">&#9432; </span>
                                  <span *ngIf="_designer.ra < -60 || _designer.ra > 200"><i title="RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200." class="fas fa-exclamation-triangle img-responsive warning"></i></span>

                                  <label for="ra_slider">RA:</label>
                                  <label for="ra_slider">{{ _designer.ra }}</label>
                                </div>
                                <div class="col-12 slider-div">
                                  <input id="ra_slider" type="range" min="-60" max="200" [disabled]='true' class="slider helper-icon" [value]="_designer.ra" step="1">
                                </div>
                              </div>
                            </div>
                          </div>
                          <div class="col-4" *ngIf="_designer.water_profile_select">
                            <div class="container">
                              <div class="row">
                                <div class="col-12">

                                  <span *ngIf="_designer.ra >= _designer.used_water_profile.ra_min && _designer.ra <= _designer.used_water_profile.ra_max" class="help-icon" title="The desired RA range for this profile is {{ _designer.used_water_profile.ra_min }} to {{ _designer.used_water_profile.ra_max }}.\n\nRA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200.">&#9432; </span>
                                  <span *ngIf="_designer.ra < _designer.used_water_profile.ra_min || _designer.ra > _designer.used_water_profile.ra_max"><i title="The desired RA range for this profile is {{ _designer.used_water_profile.ra_min }} to {{ _designer.used_water_profile.ra_max }}.&#013;&#013;RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200." class="fas fa-exclamation-triangle img-responsive warning"></i></span>

                                  <label for="ra_slider">RA:</label>
                                  <label for="ra_slider">{{ _designer.ra }}</label>
                                </div>
                                <div class="col-12 slider-div">
                                  <input id="ra_slider" type="range" min="-60" max="200" [disabled]='true' class="slider helper-icon" [value]="_designer.ra" step="1">
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-4">
                            <div class="container">
                              <div class="row">
                                <div class="col-12">

                                  <span *ngIf="_designer.so4_cl_ratio >= 0.5 && _designer.so4_cl_ratio <= 9" class="help-icon" title="The ratio of sulfate to chloride effects the maltiness of the beer. A ratio less than 1 will accentuate the maltiness, while a ratio greater than 1 will accentuate bitterness. The typical range for this ratio is from 0.5 to 9, however it only really has an effect with ppms greater than 50.">&#9432; </span>
                                  <span *ngIf="(_designer.so4_cl_ratio < 0.5 || _designer.so4_cl_ratio > 9) && (_designer.currentWater().sulfate + _designer.currentWater().chloride > 50)"><i title="The ratio of sulfate to chloride effects the maltiness of the beer. A ratio less than 1 will accentuate the maltiness, while a ratio greater than 1 will accentuate bitterness. The typical range for this ratio is from 0.5 to 9, however it only really has an effect with ppms greater than 50." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                  <label for="so4cl-slider">SO4:Cl</label>
                                  <label for="so4cl-slider">{{ _designer.so4_cl_ratio }}</label>
                                </div>
                                <div class="col-12 slider-div">
                                  <input id="so4cl-slider" type="range" min=".5" max="9" [disabled]='true' class="slider helper-icon" [value]="_designer.so4_cl_ratio" step=".1">
                                </div>
                              </div>
                            </div>
                          </div>

                          <div class="col-4">
                            <div class="container">
                              <div class="row">
                                <div class="col-12">
                                  <span *ngIf="_designer.getEstimatedPh() > 5.6 || _designer.getEstimatedPh() < 5.2"><i title="Mash pH should be between 5.2 and 5.6 in order to promote maximum enzyme efficiency and improve potential yeast health. Check the pH 10-15 minutes into the mash on a room temperature sample." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                                  <label for="mashph-slider">Mash pH:</label>
                                  <label for="mashph-slider">{{ _designer.getEstimatedPh() | number:'1.1-2' }}</label>
                                </div>
                                <div class="col-12 slider-div">
                                  <input id="mashph-slider" type="range" min="5.2" max="5.6" [disabled]='true' class="slider helper-icon" [value]="_designer.getEstimatedPh()" step=".05">
                                </div>
                              </div>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card col-12 no-pad pad-top">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <p>
                              <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#ingredientsCollapse" aria-expanded="true" aria-controls="ingredientsCollapse" (click)="ingredients_collapse=!ingredients_collapse">{{ !ingredients_collapse ? '+' : '-' }}
                              </button>
                              <b>Ingredients</b>
                            </p>
                          </div>
                        </div>
                        <div class="row collapse show" id="ingredientsCollapse">
                          <div class="col-12" *ngIf="_designer.used_waters.length < 1 && _designer.used_malts.length < 1 && _designer.used_hops.length < 1 && _designer.used_yeast.length < 1 && _designer.used_miscellaneous.length < 1">
                            <p><b>No ingredients have been added.</b></p>
                          </div>
                          <div class="col-12" *ngIf="_designer.used_waters.length > 0 || _designer.used_malts.length > 0 || _designer.used_hops.length > 0 || _designer.used_yeast.length > 0 || _designer.used_miscellaneous.length > 0">
                <table class="table table-sm table-hover">
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>%/IBU/Cells</th>
                    <th>Quantity</th>
                  </tr>

                  <tr *ngFor="let malt of _designer.used_malts; let i = index ">
                    <td>{{ malt.name }}{{ _designer.recipe.recipe_malts_attributes[i].malt_usage === 'Mash' ? '' : ' (' + _designer.recipe.recipe_malts_attributes[i].malt_usage + ')' }}</td>
                    <td>{{ _designer.maltTypes ? _designer.maltTypes[malt.malt_type_id-1].name : '' }}</td>
                    <td>
                      <span *ngIf="_designer.inputConversion(_designer.recipe.recipe_malts_attributes[i].quantity, 'malts') / _designer.getTotalMaltWeight() * 100 > malt.max_percent">
                        <i title="The suggested max percent of this malt is {{ malt.max_percent }}%. The recipe is currently using a higher percent than that." class="fas fa-exclamation-triangle img-responsive warning"></i>
                      </span>
                      {{ _designer.inputConversion(_designer.recipe.recipe_malts_attributes[i].quantity, 'malts') / _designer.getTotalMaltWeight() * 100 | number:'1.0-1' }}%
                    </td>
                    <td>{{ _designer.recipe.recipe_malts_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}</td>
                  </tr>

                  <tr *ngFor="let misc of _designer.used_miscellaneous; let i = index ">
                    <td>{{ misc.name }} ({{ misc.usage  }} {{ _designer.recipe.recipe_miscellaneous_attributes[i].time | number:'1.0-2' }})</td>
                    <td>{{ misc.miscellaneous_type }}</td>
                    <td>--</td>
                    <td>
                      <span *ngIf="misc.quantity_label === _designer.recipe.recipe_miscellaneous_attributes[i].quantity_label && _designer.abs((_designer.recipe.recipe_miscellaneous_attributes[i].quantity / _designer.recipe.batch_size) - (misc.amount / misc.batch_size)) / (misc.amount / misc.batch_size) > .05">
                        <i title="The suggested quantity for this ingredient is {{ misc.amount }} {{ misc.amount_label }} per {{ misc.batch_size }}." class="fas fa-exclamation-triangle img-responsive warning"></i>
                      </span>
                      {{ _designer.recipe.recipe_miscellaneous_attributes[i].quantity | number:'1.0-2' }} {{ _designer.recipe.recipe_miscellaneous_attributes[i].quantity_label }}</td>
                  </tr>

                  <tr *ngFor="let hop of _designer.used_hops; let i = index ">
                    <td>{{ hop.name }} ({{ _designer.displayHopInfo(_designer.recipe.recipe_hops_attributes[i].usage, _designer.recipe.recipe_hops_attributes[i].time) }})</td>
                    <td>{{ hop.hop_type }}</td>
                    <td>{{ _designer.individualIBU(_designer.recipe.recipe_hops_attributes[i], i, _designer.measurement['ibu']) | number:'1.1-1' }} IBUs</td>
                    <td>{{ _designer.recipe.recipe_hops_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.hops === 'us' ? "oz" : "g" }}</td>
                  </tr>

                  <tr *ngFor="let yeast of _designer.used_yeast; let i = index ">
                    <td>{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</td>
                    <td>Yeast - {{ yeast.form }}</td>
                    <!-- <td>{{ _designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1 ? 'Primary' : 'Secondary' }}, {{ _designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1 ? _designer.recipe.primary_ferm_temp : _designer.recipe.secondary_ferm_temp }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }}</td> -->
                    <td>{{ _designer.recipe.recipe_yeasts_attributes[i].quantity * yeast.cell_count }} billion</td>
                    <td>{{ _designer.recipe.recipe_yeasts_attributes[i].quantity | number:'1.0-1' }} pkgs</td>
                  </tr>

                  <tr *ngFor="let water of _designer.used_waters; let i = index ">
                    <td>{{ water.name }}</td>
                    <td>Water</td>
                    <td>--</td>
                    <td>{{ _designer.recipe.recipe_waters_attributes[i].quantity | number:'1.0-1' }} {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}</td>
                  </tr>

                  <tr *ngFor="let agent of _designer.getActiveAgents()">
                    <td>{{ agent.name }}</td>
                    <td>Water Agent</td>
                    <td>--</td>
                    <td>{{ agent.quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "ounces" : "grams" }}</td>
                  </tr>

                  <tr *ngFor="let acid of _designer.used_acids; let i = index ">
                    <td>{{ acid.name }}</td>
                    <td>Mash Acid</td>
                    <td>--</td>
                    <td>{{ _designer.recipe.recipe_acids_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "teaspoons" : "milliliters" }}</td>
                  </tr>

                  <tr *ngFor="let acid of _designer.used_sparge_acids; let i = index ">
                    <td>{{ acid.name }}</td>
                    <td>Sparge Acid</td>
                    <td>--</td>
                    <td>{{ _designer.recipe.recipe_acids_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "teaspoons" : "milliliters" }}</td>
                  </tr>
                </table>
                            <div>Total malt: {{ _designer.checkPoundsToGrams(_designer.getTotalMaltWeight(), 'malts') | number:'1.1-2' }} {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}</div>
                            <div>Total hops:
                              <span *ngIf="_designer.getTotalHopWeight() > (8 * _designer.inputConversion(_designer.recipe.batch_size, 'liquid') / 5)">
                                <i title="It is suggested to use at most {{_designer.checkPoundsToGrams(8, 'hops')}} {{ _designer.measurement.hops === 'us' ? 'oz' : 'g' }} of hops per {{_designer.checkGallonsToLiters(5)}} {{ (_designer.measurement.liquid === 'us' ? 'gallons' : 'liters') }} in the batch ({{8 * _designer.inputConversion(_designer.recipe.batch_size, 'liquid') / 5}} oz)." class="fas fa-exclamation-triangle img-responsive warning"></i>
                              </span>{{ _designer.checkPoundsToGrams(_designer.getTotalHopWeight(), 'hops') | number:'1.1-2' }} {{ _designer.measurement.hops === 'us' ? 'oz' : 'g' }}
                            </div>
                            <div>Total yeast: {{ _designer.getTotalYeast() | number:'1.1-2' }} pkgs - {{ _designer.getTotalYeastCells() | number:'1.1-1' }} billion cells</div>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card col-12 no-pad pad-top">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <p>
                              <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#mashCollapse" aria-expanded="true" aria-controls="mashCollapse" (click)="mash_collapse=!mash_collapse">{{ !mash_collapse ? '+' : '-' }}
                              </button>
                              <b>Mash</b>
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="container collapse show" id="mashCollapse">
                        <div class="row" *ngIf="_designer.recipe.recipe_type !== 'Extract'">
                          <div class="col-12">
                            <p>Sparge strategy: {{ _designer.getSpargeType() }}</p>
                            <p>Sparge quantity ({{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}): {{ _designer.checkGallonsToLiters(_designer.getMashWaterInfo()["sparge_amount"]) | number:'1.1-2' }}</p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <p>Mash type: {{ _designer.getMashType() }}</p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <p><b>Mash Steps</b></p>
                          </div>
                          <div class="col-12" *ngIf="_designer.getUsedMashSteps().length === 0">
                            <p><b>No mash steps have been added.</b></p>
                          </div>
                          <div class="col-12" *ngIf="_designer.getUsedMashSteps().length > 0">
                            <table class="table table-sm table-hover">
                              <tr>
                                <th>Name</th>
                                <th>Step Temp (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</th>
                                <th>Time (min)</th>
                                <th *ngIf='_designer.recipe.mash_type !== "decoction"'>Water Addition Amount ({{(_designer.measurement.liquid === 'us' ? "quarts" : "liters")}})</th>
                                <th *ngIf='_designer.recipe.mash_type === "decoction"'>Water Addition Amount ({{(_designer.measurement.liquid === 'us' ? "quarts/% mash" : "liters/% mash")}})</th>
                                <th>Water Addition Temp (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</th>
                              </tr>
                              <tr *ngFor="let step of _designer.getMashWaterInfo()['step_info']; let i = index ">
                                <td><span *ngIf="step.step_name === 'Steeping'" class="help-icon" title="Steeping is done with extract brewing, generally beginning when the water temperature reaches 140 degrees, and lasting for about 20 minutes as the temperature reaches 170 degrees.">&#9432; </span>{{ step.step_name }}</td>
                                <td>{{ _designer.checkFahrenheitToCelsius(step.step_temp) | number:'1.1-2' }}</td>
                                <td>{{ step.step_time }}</td>
                                <td *ngIf="i === 0 || _designer.recipe.mash_type !== 'decoction'">{{ step.water_amount | number:'1.1-2' }}</td>
                                <td *ngIf="i !== 0 && _designer.recipe.mash_type === 'decoction'">{{ step.water_amount | number:'1.1-1' }}%</td>
                                <td>{{ _designer.checkFahrenheitToCelsius(step.water_temp) | number:'1.1-2' }}</td>
                              </tr>
                            </table>
                          </div>
                        </div>
                      </div>
                    </div>

                    <div class="card col-12 no-pad pad-top">
                      <div class="container">
                        <div class="row">
                          <div class="col-12">
                            <p>
                              <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#yeastCollapse" aria-expanded="true" aria-controls="yeastCollapse" (click)="yeast_collapse=!yeast_collapse">{{ !yeast_collapse ? '+' : '-' }}
                              </button>
                              <b>Yeast</b>
                            </p>
                          </div>
                        </div>
                      </div>
                      <div class="container collapse show" id="yeastCollapse">
                        <div class="row">
                          <div class="col-12">
                            <p>Finish strategy: {{ _designer.recipe.storage_type }} at {{ _designer.recipe.storage_temperature | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} with {{ _designer.recipe.carbonation_with }} ({{ _designer.getVolumesQuantity() | number:'1.1-2' }} {{ _designer.volumesLabel() }})</p>
                          </div>
                        </div>
                        <div class="row">
                          <div class="col-12">
                            <p>Primary fermentation: {{ _designer.recipe.primary_ferm_temp | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} for {{ _designer.recipe.primary_ferm_days }} days</p>
                            <ul>
                              <li *ngFor="let yeast of _designer.getUsedYeast(1)">{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</li>
                            </ul>
                          </div>
                        </div>
                        <div class="row" *ngIf="_designer.recipe.secondary_fermentation">
                          <div class="col-12">
                            <p>Secondary fermentation: {{ _designer.recipe.secondary_ferm_temp | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} for {{ _designer.recipe.secondary_ferm_days }} days</p>
                            <ul>
                              <li *ngFor="let yeast of _designer.getUsedYeast(2)">{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</li>
                            </ul>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show d-md-none" id="tools-tab" role="tabpanel" aria-labelledby="pills-tools-tab">
              <h2 class="item-name">{{ _designer.recipe.name ? _designer.recipe.name : "New Recipe" }}</h2>
              <h6 class="item-name" *ngIf='_designer.recipe.brewer'> by {{ _designer.recipe.brewer }}</h6>

              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="scaleOpen(scalePopup)">Scale</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="copyOpen(copyPopup)">Copy</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="savePdf(pdfPopup)">Save to PDF</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="importXmlOpen(importXmlPopup)">Import XML</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="_designer.exportXml()">Export XML</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="_designer.clearRecipe()">Clear</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="toggleAutoAdjust(true)">Enable all auto-adjust</button>
              </div>
              <div class="row pad-bottom">
                <button type="button" class="btn btn-primary" (click)="toggleAutoAdjust(false)">Disable all auto-adjust</button>
              </div>
              <div class="row pad-bottom">
                <div class="btn-group">
                  <button type="button" title="Recipe Walk Through" class="btn btn-primary dropdown-toggle dropdown-toggle-split tools-icon save-group" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="options2-dropdown">
                    <i class="fas fa-play-circle icon img-responsive"></i>
                  </button>
                  <div class="dropdown-menu" aria-labelledby="options2-dropdown">
                    <a type="button" class="dropdown-item" (click)="runner_step=1;runRecipe(runnerPopup)">Run Recipe</a>
                    <a type="button" class="dropdown-item" (click)="runner_step=6;runRecipe(runnerPopup)">Add Reminders</a>
                  </div>
                  <button type="button" title="Save" class="btn btn-primary save-group" (click)="_authService.userSignedIn$ ? _designer.save() : save(loginPopup)">
                    <i class="fas fa-save icon img-responsive"></i>
                  </button>
                </div>
              </div>
            </div>

            <div class="tab-pane fade show" id="measurement-tab" role="tabpanel" aria-labelledby="pills-measurement-tab">
              <div class="container">
                <div class="row">
                  <div class="col-12">
                    <h2 class="item-name">Measurements</h2>
                  </div>
                </div>
                <div class="row">
                  <!-- <div class="col-6">
                    <label for="us-measurement">US</label>
                    <input type="checkbox" name="us-measurement" id="us-measurement" (click)="_designer.setMeasurement('us')">
                  </div>
                  <div class="col-6">
                    <label for="metric-measurement">Metric</label>
                    <input type="checkbox" name="metric-measurement" id="metric-measurement" (click)="_designer.setMeasurement('metric')">
                  </div> -->
                  <div class="col-12">
                    <label for="temperature-measurement">Temperature</label>
                    <select (change)="_designer.measurementChange('temperature')" id="temperature-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement.temperature">
                      <option value="us">Fahrenheit</option>
                      <option value="metric">Celsius</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="liquid-measurement">Liquid</label>
                    <select (change)="_designer.measurementChange('liquid')" id="liquid-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['liquid']">
                      <option value="us">Gallons</option>
                      <option value="metric">Liters</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="agent-measurement">Weight (Water Agents)</label>
                    <select (change)="_designer.measurementChange('agent')" id="agent-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['agents']">
                      <option value="us">Ounces</option>
                      <option value="metric">Grams</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="malt-measurement">Weight (Malts)</label>
                    <select (change)="_designer.measurementChange('malt')" id="malt-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['malts']">
                      <option value="us">Pounds</option>
                      <option value="metric">Grams</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="hop-measurement">Weight (Hops)</label>
                    <select (change)="_designer.measurementChange('hop')" id="hop-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['hops']">
                      <option value="us">Ounces</option>
                      <option value="metric">Grams</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="pressure-measurement">Pressure</label>
                    <select (change)="_designer.measurementChange('pressure')" id="pressure-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['pressure']">
                      <option value="us">PSI</option>
                      <option value="metric">kPa</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="ibu-measurement">IBU</label>
                    <select id="ibu-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['ibu']">
                      <option value="tinseth">Tinseth</option>
                      <option value="rager">Rager</option>
                      <option value="garetz">Garetz</option>
                      <option value="daniels">Daniels</option>
                      <option value="average">Average</option>
                    </select>
                  </div>
                  <div class="col-12">
                    <label for="color-measurement">Color</label>
                    <select (ngModelChange)="_designer.measurementChange('color', $event)" id="color-measurement" class="item-selector form-control" [(ngModel)]="_designer.measurement['color']">
                      <option value="srm">SRM</option>
                      <option value="lovibond">Lovibond</option>
                      <option value="ebc">EBC</option>
                    </select>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
        <div class="col-md-2 no-right-pad d-none d-md-block">
          <ul class="nav nav-pills nav-stacked border-left rounded colored" id="pills-tab" role="tablist">
            <li class="nav-item">
              <a class="nav-link active" title="General Details" id="pills-recipe-tab" href="#recipe-tab" data-toggle="pill" role="tab" aria-controls="recipe-tab" aria-expanded="true">
                <img src="../../assets/images/recipe.png" class="icon img-response" />
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" title="Mash Details" id="pills-malt-tab" href="#malt-tab" data-toggle="pill" role="tab" aria-controls="malt-tab" aria-expanded="true">
                <img src="../../assets/images/grain.png" class="icon img-response" />
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link icon-tab" title="Miscellaneous Ingredients" id="pills-misc-tab" href="#misc-tab" data-toggle="pill" role="tab" aria-controls="misc-tab" aria-expanded="true">
                <i class="fas fa-star-of-life icon img-responsive solid"></i>
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" title="Hop Details" id="pills-hop-tab" href="#hop-tab" data-toggle="pill" role="tab" aria-controls="hop-tab" aria-expanded="true">
                <img src="../../assets/images/hop.png" class="icon img-response" />
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" title="Fermentation Details" id="pills-yeast-tab" href="#yeast-tab" data-toggle="pill" role="tab" aria-controls="yeast-tab" aria-expanded="true">
                <img src="../../assets/images/yeast.png" class="icon img-response" />
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link" title="Water Details" id="pills-water-tab" href="#water-tab" data-toggle="pill" role="tab" aria-controls="water-tab" aria-expanded="true">
                <img src="../../assets/images/water.png" class="icon img-response" />
              </a>
            </li>
            <li class="nav-item">
              <a class="nav-link measurement-tab" title="Measurements" id="pills-measurement-tab" href="#measurement-tab" data-toggle="pill" role="tab" aria-controls="measurement-tab" aria-expanded="true">
                <i class="fas fa-ruler icon img-responsive solid"></i>
              </a>
            </li>
          </ul>
        </div>
      </div>
    </div>
    <div class="col-7 d-none d-md-block">
      <div class="container no-pad">
        <div class="row pad-bottom">
          <div class="col-8">
            <h2 class="item-name">{{ _designer.recipe.name ? _designer.recipe.name : "New Recipe" }}</h2>
            <h6 class="item-name" *ngIf='_designer.recipe.brewer'> by {{ _designer.recipe.brewer }}</h6>
          </div>
          <div class="col-4">
            <div class="btn-group">
              <button type="button" title="Recipe Walk Through" class="btn btn-default dropdown-toggle dropdown-toggle-split light-color tools-icon save-group" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="runner-dropdown">
                <i class="fas fa-play-circle icon img-responsive"></i>
              </button>
              <div class="dropdown-menu" aria-labelledby="runner-dropdown">
                <a type="button" class="dropdown-item" (click)="runner_step=1;runRecipe(runnerPopup)">Run Recipe</a>
                <a type="button" class="dropdown-item" (click)="runner_step=6;runRecipe(runnerPopup)">Add Reminders</a>
              </div>
            </div>
            <div class="btn-group">
              <button type="button" title="Save" class="btn btn-default light-color save-group" (click)="save(loginPopup)">
                <i class="fas fa-save icon img-responsive"></i>
              </button>
              <button type="button" title="Tools" class="btn btn-default dropdown-toggle dropdown-toggle-split light-color tools-icon save-group" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" id="tools-dropdown">
                <i class="fas fa-wrench icon img-responsive"></i>
              </button>
              <div class="dropdown-menu" aria-labelledby="tools-dropdown">
                <a type="button" class="dropdown-item" (click)="scaleOpen(scalePopup)">Scale</a>
                <a type="button" class="dropdown-item" (click)="copyOpen(copyPopup)">Copy</a>
                <a type="button" class="dropdown-item" (click)="savePdf(pdfPopup)">Save to PDF</a>
                <a type="button" class="dropdown-item" (click)="importXmlOpen(importXmlPopup)">Import XML</a>
                <a type="button" class="dropdown-item" (click)="_designer.exportXml()">Export XML</a>
                <a type="button" class="dropdown-item" (click)="_designer.clearRecipe()">Clear</a>
                <a type="button" class="dropdown-item" (click)="toggleAutoAdjust(true)">Enable all auto-adjust</a>
                <a type="button" class="dropdown-item" (click)="toggleAutoAdjust(false)">Disable all auto-adjust</a>
              </div>
            </div>
          </div>
        </div>

        <div class="card col-12 no-pad pad-top">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <p *ngIf="_designer.used_style">
                  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#styleCollapse2" aria-expanded="true" aria-controls="styleCollapse2" (click)="style_collapse=!style_collapse">{{ !style_collapse ? '+' : '-' }}
                  </button>
                  <b>Style Proximity: {{ _designer.used_style.name }}</b>
                </p>
                <p *ngIf="!_designer.used_style">
                  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#styleCollapse" aria-expanded="true" aria-controls="styleCollapse" (click)="style_collapse=!style_collapse">{{ !style_collapse ? '+' : '-' }}
                  </button>
                  <b>Style Proximity: None Selected</b>
                </p>
              </div>
            </div>
          </div>
          <div class="container collapse show" id="styleCollapse2">
            <div class="row">
              <div class="col-9">
                <table class="table table-sm table-hover">
                  <tr>
                    <th></th>
                    <th>Current</th>
                    <th *ngIf="_designer.used_style"></th>
                    <th *ngIf="_designer.used_style">Style</th>
                  </tr>

                  <tr>
                    <th>Original Gravity</th>
                    <td>{{ _designer.getEstimatedOG() | number:'1.1-3' }}</td>
                    <td *ngIf="_designer.used_style && _designer.getEstimatedOG() >= _designer.used_style.min_og && _designer.getEstimatedOG() <= _designer.used_style.max_og"><i class="fas fa-check correct"></i></td>
                    <td *ngIf="_designer.used_style && (_designer.getEstimatedOG() < _designer.used_style.min_og || _designer.getEstimatedOG() > _designer.used_style.max_og)"><i class="fas fa-times-circle error"></i></td>
                    <td *ngIf="_designer.used_style">{{ _designer.used_style.min_og }} - {{ _designer.used_style.max_og }}</td>
                  </tr>

                  <tr>
                    <th>Bitterness (IBU)
                      <div>
                        <span class="help-icon" title="{{ _designer.getIbuMethodText() }}">&#9432; </span>
                        <select id="ibu-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['ibu']">
                          <option value="tinseth">Tinseth</option>
                          <option value="rager">Rager</option>
                          <option value="garetz">Garetz</option>
                          <option value="daniels">Daniels</option>
                          <option value="average">Average</option>
                        </select>
                      </div>
                    </th>
                    <td>{{ _designer.calculateIBU(_designer.measurement.ibu) | number:'1.1-1' }}</td>
                    <td *ngIf="_designer.used_style && _designer.calculateIBU(_designer.measurement.ibu) >= _designer.used_style.min_ibu && _designer.calculateIBU(_designer.measurement.ibu) <= _designer.used_style.max_ibu"><i class="fas fa-check correct"></i></td>
                    <td *ngIf="_designer.used_style && (_designer.calculateIBU(_designer.measurement.ibu) < _designer.used_style.min_ibu || _designer.calculateIBU(_designer.measurement.ibu) > _designer.used_style.max_ibu)"><i class="fas fa-times-circle error"></i></td>
                    <td *ngIf="_designer.used_style"> {{ _designer.used_style.min_ibu }} - {{ _designer.used_style.max_ibu }}</td>
                  </tr>

                  <tr>
                    <th>Color (
                      <select (ngModelChange)="_designer.measurementChange('color', $event)" id="color-measurement" class="tiny-element" [(ngModel)]="_designer.measurement['color']">
                        <option value="srm">SRM</option>
                        <option value="lovibond">L</option>
                        <option value="ebc">EBC</option>
                      </select>)
                    </th>
                    <td>{{ _designer.getBeerColorValue() | number:'1.1-1'}}</td>
                    <td *ngIf="_designer.used_style && _designer.getBeerColorValue() >= _designer.checkColor(_designer.used_style.min_color) && _designer.getBeerColorValue() <= _designer.checkColor(_designer.used_style.max_color)"><i class="fas fa-check correct"></i></td>
                    <td *ngIf="_designer.used_style && (_designer.getBeerColorValue() < _designer.checkColor(_designer.used_style.min_color) || _designer.getBeerColorValue() > _designer.checkColor(_designer.used_style.max_color))"><i class="fas fa-times-circle error"></i></td>
                    <td *ngIf="_designer.used_style">{{ _designer.checkColor(_designer.used_style.min_color) | number:'1.0-2' }} - {{ _designer.checkColor(_designer.used_style.max_color) | number:'1.0-2' }}</td>
                  </tr>

                  <tr>
                    <th>Final Gravity (%)</th>
                    <td>{{ _designer.getEstimatedFG() | number:'1.1-3' }}</td>
                    <td *ngIf="_designer.used_style && _designer.getEstimatedFG() >= _designer.used_style.min_fg && _designer.getEstimatedFG() <= _designer.used_style.max_fg"><i class="fas fa-check correct"></i></td>
                    <td *ngIf="_designer.used_style && (_designer.getEstimatedFG() < _designer.used_style.min_fg || _designer.getEstimatedFG() > _designer.used_style.max_fg)"><i class="fas fa-times-circle error"></i></td>
                    <td *ngIf="_designer.used_style">{{ _designer.used_style.min_fg }} - {{ _designer.used_style.max_fg }}</td>
                  </tr>

                  <tr>
                    <th>ABV (%)</th>
                    <td>{{ _designer.getEstimatedABV() | number:'1.0-1' }}</td>
                    <td *ngIf="_designer.used_style && _designer.getEstimatedABV() >= _designer.used_style.min_abv && _designer.getEstimatedABV() <= _designer.used_style.max_abv"><i class="fas fa-check correct"></i></td>
                    <td *ngIf="_designer.used_style && (_designer.getEstimatedABV() < _designer.used_style.min_abv || _designer.getEstimatedABV() > _designer.used_style.max_abv)"><i class="fas fa-times-circle error"></i></td>
                    <td *ngIf="_designer.used_style">{{ _designer.used_style.min_abv }} - {{ _designer.used_style.max_abv }}</td>
                  </tr>

                </table>
              </div>
              <div class="col-3">
                <img class="beer-glass" src="../../assets/images/empty_glass2.png" [ngStyle]="{'background-color': _designer.getBeerColor()}">
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <span class="help-icon" title="Note: The ratio here is calculated using raw, unrounded numbers for the purpose of accuracy.">&#9432; </span>
                <span>Bitterness ratio: {{ _designer.calculateIBU(_designer.measurement.ibu) / (_designer.getEstimatedOG() - 1) / 1000 | number:'1.0-3' }} IBU/SG</span>
              </div>
            </div>
          </div>
        </div>

        <div class="card col-12 no-pad pad-top">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <p>
                  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#waterCollapse2" aria-expanded="true" aria-controls="waterCollapse2" (click)="water_collapse=!water_collapse">{{ !water_collapse ? '+' : '-' }}
                  </button>
                  <b>Water Profile</b>
                </p>
              </div>
            </div>
          </div>
          <div class="container collapse show" id="waterCollapse2">
            <div class="row">
              <p class="col-12">Batch size: {{ _designer.recipe.batch_size| number:'1.0-1' }} {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}</p>
              <p class="col-12">Estimated {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }} required: {{ _designer.checkGallonsToLiters(_designer.estimateGallonsNeeded()) | number:'1.0-1' }}</p>
              <p class="col-12">Estimated pre-boil volume: {{ _designer.checkGallonsToLiters(_designer.estimatePreGallons()) | number:'1.0-1' }}</p>
            </div>

            <div class="row">
              <table class="table table-sm table-hover">
                <tr *ngIf="_designer.water_profile_select && _designer.currentWater() && _designer.used_water_profile">
                  <th class="text-center"><span class="help-icon" title="{{_designer.agentTitle('main')}}">&#9432; </span></th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('ph')" class="help-icon" title="{{_designer.agentTitle('ph')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('ph')"><i title="{{_designer.agentTitle('ph')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    pH
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.currentWater().calcium >= _designer.used_water_profile.calcium_min && _designer.currentWater().calcium <= _designer.used_water_profile.calcium_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.calcium_min }} and {{ _designer.used_water_profile.calcium_max }} ppm.">&#9432; </span>
                    <span *ngIf="_designer.currentWater().calcium > _designer.used_water_profile.calcium_max || _designer.currentWater().calcium < _designer.used_water_profile.calcium_min"><i title="{{_designer.agentTitle('ca')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Ca
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.currentWater().magnesium >= _designer.used_water_profile.magnesium_min && _designer.currentWater().magnesium <= _designer.used_water_profile.magnesium_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.magnesium_min }} and {{ _designer.used_water_profile.magnesium_max }} ppm.">&#9432; </span>
                    <span *ngIf="_designer.currentWater().magnesium > _designer.used_water_profile.magnesium_max || _designer.currentWater().magnesium < _designer.used_water_profile.magnesium_min"><i title="{{_designer.agentTitle('mg')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Mg
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.currentWater().sodium >= 0 && _designer.currentWater().sodium <= 150" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between 0 and 150 ppm.">&#9432; </span>
                    <span *ngIf="_designer.currentWater().sodium > 150 || _designer.currentWater().sodium < 0"><i title="{{_designer.agentTitle('na')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Na
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.currentWater().sulfate >= _designer.used_water_profile.sulfate_min && _designer.currentWater().sulfate <= _designer.used_water_profile.sulfate_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.sulfate_min }} and {{ _designer.used_water_profile.sulfate_max }} ppm.">&#9432; </span>
                    <span *ngIf="_designer.currentWater().sulfate > _designer.used_water_profile.sulfate_max || _designer.currentWater().sulfate < _designer.used_water_profile.sulfate_min"><i title="{{_designer.agentTitle('so4')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    SO4
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.currentWater().chloride >= _designer.used_water_profile.chloride_min && _designer.currentWater().chloride <= _designer.used_water_profile.chloride_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.chloride_min }} and {{ _designer.used_water_profile.chloride_max }} ppm.">&#9432; </span>
                    <span *ngIf="_designer.currentWater().chloride > _designer.used_water_profile.chloride_max || _designer.currentWater().chloride < _designer.used_water_profile.chloride_min"><i title="{{_designer.agentTitle('cl')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Cl
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.currentWater().bicarbonate >= _designer.used_water_profile.alkalinity_min && _designer.currentWater().bicarbonate <= _designer.used_water_profile.alkalinity_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.alkalinity_min }} and {{ _designer.used_water_profile.alkalinity_max }} ppm.">&#9432; </span>
                    <span *ngIf="_designer.currentWater().bicarbonate > _designer.used_water_profile.alkalinity_max || _designer.currentWater().bicarbonate < _designer.used_water_profile.alkalinity_min"><i title="{{_designer.agentTitle('hco3')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    HCO3
                  </th>
                </tr>
                <tr *ngIf="!_designer.water_profile_select">
                  <th class="text-center"><span class="help-icon" title="{{_designer.agentTitle('main')}}">&#9432; </span></th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('ph')" class="help-icon" title="{{_designer.agentTitle('ph')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('ph')"><i title="{{_designer.agentTitle('ph')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    pH
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('ca')" class="help-icon" title="{{_designer.agentTitle('ca')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('ca')"><i title="{{_designer.agentTitle('ca')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Ca
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('mg')" class="help-icon" title="{{_designer.agentTitle('mg')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('mg')" [ngClass]="{'error': (_designer.currentWater() && _designer.currentWater().magnesium >= 125), 'warning': (_designer.currentWater() && _designer.currentWater().magnesium < 125)}"><i title="{{_designer.agentTitle('mg')}}" class="fas fa-exclamation-triangle img-responsive"></i></span>
                    Mg
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('na')" class="help-icon" title="{{_designer.agentTitle('na')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('na')"><i title="{{_designer.agentTitle('na')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Na
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('so4')" class="help-icon" title="{{_designer.agentTitle('so4')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('so4')"><i title="{{_designer.agentTitle('so4')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    SO4
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('cl')" class="help-icon" title="{{_designer.agentTitle('cl')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('cl')"><i title="{{_designer.agentTitle('cl')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    Cl
                  </th>
                  <th class="text-right">
                    <span *ngIf="_designer.agentPortion('hco3')" class="help-icon" title="{{_designer.agentTitle('hco3')}}">&#9432; </span>
                    <span *ngIf="!_designer.agentPortion('hco3')"><i title="{{_designer.agentTitle('hco3')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                    HCO3
                  </th>
                </tr>
                <tr>
                  <td>Current Water</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().ph.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().calcium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().magnesium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().sodium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().sulfate.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().chloride.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().bicarbonate.toFixed(1) : '--'}}</td>
                </tr>
                <tr *ngIf="!_designer.water_profile_select">
                  <td>Target Water</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.ph.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.calcium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.magnesium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.sodium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.sulfate.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.chloride.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.target_water ? _designer.target_water.bicarbonate.toFixed(1) : '--'}}</td>
                </tr>
                <tr class="difference" *ngIf="!_designer.water_profile_select">
                  <td>Difference</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().ph.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().calcium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().magnesium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().sodium.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().sulfate.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().chloride.toFixed(1) : '--'}}</td>
                  <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().bicarbonate.toFixed(1) : '--'}}</td>
                </tr>
              </table>
            </div>

            <div class="row" *ngIf="_designer.used_water_profile && _designer.used_waters[0] && _designer.water_profile_select">
              <app-radar-chart [canvas_id]="'profileChart'" [boundary]="_designer.used_water_profile" [current_water]="_designer.currentWater()"></app-radar-chart>
            </div>
            <div class="row">

              <div class="col-4" *ngIf="!_designer.water_profile_select">
                <div class="container">
                  <div class="row">
                    <div class="col-12">

                      <span *ngIf="_designer.ra >= -60 && _designer.ra <= 200" class="help-icon" title="RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200.">&#9432; </span>
                      <span *ngIf="_designer.ra < -60 || _designer.ra > 200"><i title="RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200." class="fas fa-exclamation-triangle img-responsive warning"></i></span>

                      <label for="ra_slider">RA:</label>
                      <label for="ra_slider">{{ _designer.ra }}</label>
                    </div>
                    <div class="col-12 slider-div">
                      <input id="ra_slider" type="range" min="-60" max="200" [disabled]='true' class="slider helper-icon" [value]="_designer.ra" step="1">
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-4" *ngIf="_designer.water_profile_select">
                <div class="container">
                  <div class="row">
                    <div class="col-12">

                      <span *ngIf="_designer.ra >= _designer.used_water_profile.ra_min && _designer.ra <= _designer.used_water_profile.ra_max" class="help-icon" title="The desired RA range for this profile is {{ _designer.used_water_profile.ra_min }} to {{ _designer.used_water_profile.ra_max }}.\n\nRA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200.">&#9432; </span>
                      <span *ngIf="_designer.ra < _designer.used_water_profile.ra_min || _designer.ra > _designer.used_water_profile.ra_max"><i title="The desired RA range for this profile is {{ _designer.used_water_profile.ra_min }} to {{ _designer.used_water_profile.ra_max }}.&#013;&#013;RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200." class="fas fa-exclamation-triangle img-responsive warning"></i></span>

                      <label for="ra_slider">RA:</label>
                      <label for="ra_slider">{{ _designer.ra }}</label>
                    </div>
                    <div class="col-12 slider-div">
                      <input id="ra_slider" type="range" min="-60" max="200" [disabled]='true' class="slider helper-icon" [value]="_designer.ra" step="1">
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-4">
                <div class="container">
                  <div class="row">
                    <div class="col-12">

                      <span *ngIf="_designer.so4_cl_ratio >= 0.5 && _designer.so4_cl_ratio <= 9" class="help-icon" title="The ratio of sulfate to chloride effects the maltiness of the beer. A ratio less than 1 will accentuate the maltiness, while a ratio greater than 1 will accentuate bitterness. The typical range for this ratio is from 0.5 to 9, however it only really has an effect with ppms greater than 50.">&#9432; </span>
                      <span *ngIf="(_designer.so4_cl_ratio < 0.5 || _designer.so4_cl_ratio > 9) && (_designer.currentWater().sulfate + _designer.currentWater().chloride > 50)"><i title="The ratio of sulfate to chloride effects the maltiness of the beer. A ratio less than 1 will accentuate the maltiness, while a ratio greater than 1 will accentuate bitterness. The typical range for this ratio is from 0.5 to 9, however it only really has an effect with ppms greater than 50." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                      <label for="so4cl-slider">SO4:Cl</label>
                      <label for="so4cl-slider">{{ _designer.so4_cl_ratio }}</label>
                    </div>
                    <div class="col-12 slider-div">
                      <input id="so4cl-slider" type="range" min=".5" max="9" [disabled]='true' class="slider helper-icon" [value]="_designer.so4_cl_ratio" step=".1">
                    </div>
                  </div>
                </div>
              </div>

              <div class="col-4">
                <div class="container">
                  <div class="row">
                    <div class="col-12">
                      <span *ngIf="_designer.getEstimatedPh() > 5.6 || _designer.getEstimatedPh() < 5.2"><i title="Mash pH should be between 5.2 and 5.6 in order to promote maximum enzyme efficiency and improve potential yeast health. Check the pH 10-15 minutes into the mash on a room temperature sample." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                      <label for="mashph-slider">Mash pH:</label>
                      <label for="mashph-slider">{{ _designer.getEstimatedPh() | number:'1.1-2' }}</label>
                    </div>
                    <div class="col-12 slider-div">
                      <input id="mashph-slider" type="range" min="5.2" max="5.6" [disabled]='true' class="slider helper-icon" [value]="_designer.getEstimatedPh()" step=".05">
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="card col-12 no-pad pad-top">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <p>
                  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#ingredientsCollapse2" aria-expanded="true" aria-controls="ingredientsCollapse2" (click)="ingredients_collapse=!ingredients_collapse">{{ !ingredients_collapse ? '+' : '-' }}
                  </button>
                  <b>Ingredients</b>
                </p>
              </div>
            </div>
            <div class="row collapse show" id="ingredientsCollapse2">
              <div class="col-12" *ngIf="_designer.used_waters.length < 1 && _designer.used_malts.length < 1 && _designer.used_hops.length < 1 && _designer.used_yeast.length < 1 && _designer.used_miscellaneous.length < 1">
                <p><b>No ingredients have been added.</b></p>
              </div>
              <div class="col-12" *ngIf="_designer.used_waters.length > 0 || _designer.used_malts.length > 0 || _designer.used_hops.length > 0 || _designer.used_yeast.length > 0 || _designer.used_miscellaneous.length > 0">
                <table class="table table-sm table-hover">
                  <tr>
                    <th>Name</th>
                    <th>Type</th>
                    <th>%/IBU/Cells</th>
                    <th>Quantity</th>
                  </tr>

                  <tr *ngFor="let malt of _designer.used_malts; let i = index ">
                    <td>{{ malt.name }}{{ _designer.recipe.recipe_malts_attributes[i].malt_usage === 'Mash' ? '' : ' (' + _designer.recipe.recipe_malts_attributes[i].malt_usage + ')' }}</td>
                    <td>{{ _designer.maltTypes ? _designer.maltTypes[malt.malt_type_id-1].name : '' }}</td>
                    <td>
                      <span *ngIf="_designer.inputConversion(_designer.recipe.recipe_malts_attributes[i].quantity, 'malts') / _designer.getTotalMaltWeight() * 100 > malt.max_percent">
                        <i title="The suggested max percent of this malt is {{ malt.max_percent }}%. The recipe is currently using a higher percent than that." class="fas fa-exclamation-triangle img-responsive warning"></i>
                      </span>
                      {{ _designer.inputConversion(_designer.recipe.recipe_malts_attributes[i].quantity, 'malts') / _designer.getTotalMaltWeight() * 100 | number:'1.0-1' }}%
                    </td>
                    <td>{{ _designer.recipe.recipe_malts_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}</td>
                  </tr>

                  <tr *ngFor="let misc of _designer.used_miscellaneous; let i = index ">
                    <td>{{ misc.name }} ({{ misc.usage  }} {{ _designer.recipe.recipe_miscellaneous_attributes[i].time | number:'1.0-2' }})</td>
                    <td>{{ misc.miscellaneous_type }}</td>
                    <td>--</td>
                    <td>
                      <span *ngIf="misc.quantity_label === _designer.recipe.recipe_miscellaneous_attributes[i].quantity_label && _designer.abs((_designer.recipe.recipe_miscellaneous_attributes[i].quantity / _designer.recipe.batch_size) - (misc.amount / misc.batch_size)) / (misc.amount / misc.batch_size) > .05">
                        <i title="The suggested quantity for this ingredient is {{ misc.amount }} {{ misc.amount_label }} per {{ misc.batch_size }}." class="fas fa-exclamation-triangle img-responsive warning"></i>
                      </span>
                      {{ _designer.recipe.recipe_miscellaneous_attributes[i].quantity | number:'1.0-2' }} {{ _designer.recipe.recipe_miscellaneous_attributes[i].quantity_label }}</td>
                  </tr>

                  <tr *ngFor="let hop of _designer.used_hops; let i = index ">
                    <td>{{ hop.name }} ({{ _designer.displayHopInfo(_designer.recipe.recipe_hops_attributes[i].usage, _designer.recipe.recipe_hops_attributes[i].time) }})</td>
                    <td>{{ hop.hop_type }}</td>
                    <td>{{ _designer.individualIBU(_designer.recipe.recipe_hops_attributes[i], i, _designer.measurement['ibu']) | number:'1.1-1' }} IBUs</td>
                    <td>{{ _designer.recipe.recipe_hops_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.hops === 'us' ? "oz" : "g" }}</td>
                  </tr>

                  <tr *ngFor="let yeast of _designer.used_yeast; let i = index ">
                    <td>{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</td>
                    <td>Yeast - {{ yeast.form }}</td>
                    <!-- <td>{{ _designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1 ? 'Primary' : 'Secondary' }}, {{ _designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1 ? _designer.recipe.primary_ferm_temp : _designer.recipe.secondary_ferm_temp }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }}</td> -->
                    <td>{{ _designer.recipe.recipe_yeasts_attributes[i].quantity * yeast.cell_count }} billion</td>
                    <td>{{ _designer.recipe.recipe_yeasts_attributes[i].quantity | number:'1.0-1' }} pkgs</td>
                  </tr>

                  <tr *ngFor="let water of _designer.used_waters; let i = index ">
                    <td>{{ water.name }}</td>
                    <td>Water</td>
                    <td>--</td>
                    <td>{{ _designer.recipe.recipe_waters_attributes[i].quantity | number:'1.0-1' }} {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}</td>
                  </tr>

                  <tr *ngFor="let agent of _designer.getActiveAgents()">
                    <td>{{ agent.name }}</td>
                    <td>Water Agent</td>
                    <td>--</td>
                    <td>{{ agent.quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "ounces" : "grams" }}</td>
                  </tr>

                  <tr *ngFor="let acid of _designer.used_acids; let i = index ">
                    <td>{{ acid.name }}</td>
                    <td>Mash Acid</td>
                    <td>--</td>
                    <td>{{ _designer.recipe.recipe_acids_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "teaspoons" : "milliliters" }}</td>
                  </tr>

                  <tr *ngFor="let acid of _designer.used_sparge_acids; let i = index ">
                    <td>{{ acid.name }}</td>
                    <td>Sparge Acid</td>
                    <td>--</td>
                    <td>{{ _designer.recipe.recipe_acids_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "teaspoons" : "milliliters" }}</td>
                  </tr>
                </table>
                <div>Total malt: {{ _designer.checkPoundsToGrams(_designer.getTotalMaltWeight(), 'malts') | number:'1.1-2' }} {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}</div>
                <div>Total hops:
                  <span *ngIf="_designer.getTotalHopWeight() > (8 * _designer.inputConversion(_designer.recipe.batch_size, 'liquid') / 5)">
                    <i title="It is suggested to use at most {{_designer.checkPoundsToGrams(8, 'hops')}} {{ _designer.measurement.hops === 'us' ? 'oz' : 'g' }} of hops per {{_designer.checkGallonsToLiters(5)}} {{ (_designer.measurement.liquid === 'us' ? 'gallons' : 'liters') }} in the batch ({{8 * _designer.inputConversion(_designer.recipe.batch_size, 'liquid') / 5}} oz)." class="fas fa-exclamation-triangle img-responsive warning"></i>
                  </span>{{ _designer.checkPoundsToGrams(_designer.getTotalHopWeight(), 'hops') | number:'1.1-2' }} {{ _designer.measurement.hops === 'us' ? 'oz' : 'g' }}
                </div>
                <div>Total yeast: {{ _designer.getTotalYeast() | number:'1.1-2' }} pkgs - {{ _designer.getTotalYeastCells() | number:'1.1-1' }} billion cells</div>
              </div>
            </div>
          </div>
        </div>

        <div class="card col-12 no-pad pad-top">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <p>
                  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#mashCollapse2" aria-expanded="true" aria-controls="mashCollapse2" (click)="mash_collapse=!mash_collapse">{{ !mash_collapse ? '+' : '-' }}
                  </button>
                  <b>Mash</b>
                </p>
              </div>
            </div>
          </div>
          <div class="container collapse show" id="mashCollapse2">
            <div class="row">
              <div class="col-12">
                <p>Sparge strategy: {{ _designer.getSpargeType() }}</p>
                <p>Sparge quantity ({{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}): {{ _designer.checkGallonsToLiters(_designer.getMashWaterInfo()["sparge_amount"]) | number:'1.1-2' }}</p>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <p>Mash type: {{ _designer.getMashType() }}</p>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <p><b>Mash Steps</b></p>
              </div>
              <div class="col-12" *ngIf="_designer.getUsedMashSteps().length === 0">
                <p><b>No mash steps have been added.</b></p>
              </div>
              <div class="col-12" *ngIf="_designer.getUsedMashSteps().length > 0">
                <table class="table table-sm table-hover">
                  <tr>
                    <th>Name</th>
                    <th>Step Temp (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</th>
                    <th>Time (min)</th>
                    <th *ngIf='_designer.recipe.mash_type !== "decoction"'>Water Addition Amount ({{(_designer.measurement.liquid === 'us' ? "quarts" : "liters")}})</th>
                    <th *ngIf='_designer.recipe.mash_type === "decoction"'>Water Addition Amount ({{(_designer.measurement.liquid === 'us' ? "quarts/% mash" : "liters/% mash")}})</th>
                    <th>Water Addition Temp (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</th>
                  </tr>
                  <tr *ngFor="let step of _designer.getMashWaterInfo()['step_info']; let i = index ">
                    <td><span *ngIf="step.step_name === 'Steeping'" class="help-icon" title="Steeping is done with extract brewing, generally beginning when the water temperature reaches 140 degrees, and lasting for about 20 minutes as the temperature reaches 170 degrees.">&#9432; </span>{{ step.step_name }}</td>
                    <td>{{ _designer.checkFahrenheitToCelsius(step.step_temp) | number:'1.1-2' }}</td>
                    <td>{{ step.step_time }}</td>
                    <td *ngIf="i === 0 || _designer.recipe.mash_type !== 'decoction'">{{ step.water_amount | number:'1.1-2' }}</td>
                    <td *ngIf="i !== 0 && _designer.recipe.mash_type === 'decoction'">{{ step.water_amount | number:'1.1-1' }}%</td>
                    <td>{{ _designer.checkFahrenheitToCelsius(step.water_temp) | number:'1.1-2' }}</td>
                  </tr>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="card col-12 no-pad pad-top">
          <div class="container">
            <div class="row">
              <div class="col-12">
                <p>
                  <button class="btn btn-primary" type="button" data-toggle="collapse" data-target="#yeastCollapse2" aria-expanded="true" aria-controls="yeastCollapse2" (click)="yeast_collapse=!yeast_collapse">{{ !yeast_collapse ? '+' : '-' }}
                  </button>
                  <b>Yeast</b>
                </p>
              </div>
            </div>
          </div>
          <div class="container collapse show" id="yeastCollapse2">
            <div class="row">
              <div class="col-12">
                <p>Finish strategy: {{ _designer.recipe.storage_type }} at {{ _designer.recipe.storage_temperature | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} with {{ _designer.recipe.carbonation_with }} ({{ _designer.getVolumesQuantity() | number:'1.1-2' }} {{ _designer.volumesLabel() }})</p>
              </div>
            </div>
            <div class="row">
              <div class="col-12">
                <p>Primary fermentation: {{ _designer.recipe.primary_ferm_temp | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} for {{ _designer.recipe.primary_ferm_days }} days</p>
                <ul>
                  <li *ngFor="let yeast of _designer.getUsedYeast(1)">{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</li>
                </ul>
              </div>
            </div>
            <div class="row" *ngIf="_designer.recipe.secondary_fermentation">
              <div class="col-12">
                <p>Secondary fermentation: {{ _designer.recipe.secondary_ferm_temp | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} for {{ _designer.recipe.secondary_ferm_days }} days</p>
                <ul>
                  <li *ngFor="let yeast of _designer.getUsedYeast(2)">{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</li>
                </ul>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>
</div>

<ng-template #loginPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Login</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <form (ngSubmit)="onSignInSubmit()" #f="ngForm">

            <span class="text-danger">
              <p *ngFor="let error of signInErrors"> {{ error }}</p>
            </span>

            <div class="form-group">
              <label class="sr-only" for="username">Email address</label>
              <input type="text" name="username" id="username" class="form-control" placeholder="Email address" [(ngModel)]="signIn.email" required>

              <label class="sr-only" for="password">Password</label>
              <input type="password" name="password" id="password" class="form-control" placeholder="Password" [(ngModel)]="signIn.password" required>
            </div>

            <div class="text-center">
              New here? <a href="register" target="_blank">Register</a>
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="!f.valid">Sign in</button>
            <button type="button" class="btn btn-default" (click)="c('Close click')">Cancel</button>
          </form>
        </div>
      </div>
    </div>

  </div>
</ng-template>

<ng-template #scalePopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Scale Recipe</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <form #f="ngForm" (ngSubmit)="scaleSubmit(f.value)">
            <div class="row pad-bottom">
              <label for="scale_number">Scale to: </label>
              <input type="number" class="form-control" id="scale_number" name="scale_number" step="0.1" min="1" max="999.9" pattern="^\d{0,3}(\.\d{0,1})?$" [(ngModel)]="scale_number">
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="!f.valid">Scale</button>
            <button type="button" class="btn btn-default" (click)="c('Close click')">Cancel</button>
          </form>

        </div>
      </div>
    </div>

  </div>
</ng-template>

<ng-template #copyPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Copy Recipe</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="container">
      <div class="row">
        <div class="col-md-12">
          <form #f="ngForm" (ngSubmit)="copySubmit(f.value)">
            <div class="row pad-bottom">
              <label for="copy-name">Copy's name: </label>
              <input type="text" id="copy-name" class="form-control" min="0" max="40" placeholder="Deliciauto The Great" [(ngModel)]="copy_name" [ngModelOptions]="{standalone: true}" >
            </div>

            <button type="submit" class="btn btn-primary" [disabled]="!f.valid">Copy</button>
            <button type="button" class="btn btn-default" (click)="c('Close click')">Cancel</button>
          </form>

        </div>
      </div>
    </div>

  </div>
</ng-template>

<ng-template #pdfPopup let-c="close" let-d="dismiss">
  <div id="pdf" class="size-limit">
    <div class="card col-12">
      <div class="container">
        <div class="row">
          <div class="col-12">
            <h1>{{ _designer.recipe.name }}</h1>
          </div>
        </div>
        <div class="row">
          <div class="col-sm-9 col-12">
            <table class="table table-sm table-striped d-none d-md-block">
              <tbody>
                <tr>
                  <th colspan="2">Brewer</th>
                  <td colspan="2">{{ _designer.recipe.brewer }}</td>
                </tr>
                <tr>
                  <th>Date Created</th>
                  <td>{{ _designer.recipe.recipe_date | date }}</td>
                  <th>Version</th>
                  <td>{{ _designer.recipe.version }}</td>
                </tr>
                <tr>
                  <th>Style</th>
                  <td>{{ _designer.used_style ? _designer.used_style.name : 'None selected' }}</td>
                  <th>Batch Size</th>
                  <td>{{ _designer.recipe.batch_size }} {{ (_designer.measurement.liquid === 'us' ? "gal" : "l") }}</td>
                </tr>
                <tr>
                  <th>Equipment</th>
                  <td>{{ _designer.used_equipment ? _designer.used_equipment.name : '' }}</td>
                  <th>Type</th>
                  <td>{{ _designer.used_equipment ? _designer.recipe.recipe_type : '' }}</td>
                </tr>
              </tbody>
            </table>

            <table class="table table-sm table-striped d-block d-md-none">
              <tbody>
                <tr>
                  <th colspan="2">Brewer</th>
                </tr>
                <tr>
                  <td colspan="2">{{ _designer.recipe.brewer }}</td>
                </tr>
                <tr>
                  <th>Date Created</th>
                  <td>{{ _designer.recipe.recipe_date | date }}</td>
                </tr>
                <tr>
                  <th>Version</th>
                  <td>{{ _designer.recipe.version }}</td>
                </tr>
                <tr>
                  <th>Style</th>
                  <td>{{ _designer.used_style ? _designer.used_style.name : 'None selected' }}</td>
                </tr>
                <tr>
                  <th>Batch Size</th>
                  <td>{{ _designer.recipe.batch_size }} {{ (_designer.measurement.liquid === 'us' ? "gal" : "l") }}</td>
                </tr>
                <tr>
                  <th>Equipment</th>
                  <td>{{ _designer.used_equipment ? _designer.used_equipment.name : '' }}</td>
                </tr>
                <tr>
                  <th>Type</th>
                  <td>{{ _designer.used_equipment ? _designer.recipe.recipe_type : '' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

          <div class="col-sm-3 col-12">
            <img class="beer-glass" src="../../assets/images/empty_glass2.png" [ngStyle]="{'background-color': _designer.getBeerColor()}">
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <p><i title="Rice or barley hulls are advised for high gravity and high adjunct beers." *ngIf="_designer.riceHullsRequired()" class="fas fa-exclamation-triangle img-responsive warning"></i><b>Ingredients</b></p>
          </div>
          <div class="col-12" *ngIf="_designer.used_waters.length < 1 && _designer.used_malts.length < 1 && _designer.used_hops.length < 1 && _designer.used_yeast.length < 1 && _designer.used_miscellaneous.length < 1">
            <p><b>No ingredients have been added.</b></p>
          </div>
          <div class="col-12" *ngIf="_designer.used_waters.length > 0 || _designer.used_malts.length > 0 || _designer.used_hops.length > 0 || _designer.used_yeast.length > 0 || _designer.used_miscellaneous.length > 0">
            <table class="table table-sm table-hover">
              <tr>
                <th>Name</th>
                <th>Type</th>
                <th>%/IBU/Cells</th>
                <th>Quantity</th>
              </tr>

              <tr *ngFor="let malt of _designer.used_malts; let i = index ">
                <td>{{ malt.name }}{{ _designer.recipe.recipe_malts_attributes[i].malt_usage === 'Mash' ? '' : ' (' + _designer.recipe.recipe_malts_attributes[i].malt_usage + ')' }}</td>
                <td>{{ _designer.maltTypes ? _designer.maltTypes[malt.malt_type_id-1].name : '' }}</td>
                <td>
                  <span *ngIf="_designer.inputConversion(_designer.recipe.recipe_malts_attributes[i].quantity, 'malts') / _designer.getTotalMaltWeight() * 100 > malt.max_percent">
                    <i title="The suggested max percent of this malt is {{ malt.max_percent }}%. The recipe is currently using a higher percent than that." class="fas fa-exclamation-triangle img-responsive warning"></i>
                  </span>
                  {{ _designer.inputConversion(_designer.recipe.recipe_malts_attributes[i].quantity, 'malts') / _designer.getTotalMaltWeight() * 100 | number:'1.0-1' }}%
                </td>
                <td>{{ _designer.recipe.recipe_malts_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}</td>
              </tr>

              <tr *ngFor="let misc of _designer.used_miscellaneous; let i = index ">
                <td>{{ misc.name }} ({{ misc.usage  }} {{ _designer.recipe.recipe_miscellaneous_attributes[i].time | number:'1.0-2' }})</td>
                <td>{{ misc.miscellaneous_type }}</td>
                <td>--</td>
                <td>
                  <span *ngIf="misc.quantity_label === _designer.recipe.recipe_miscellaneous_attributes[i].quantity_label && _designer.abs((_designer.recipe.recipe_miscellaneous_attributes[i].quantity / _designer.recipe.batch_size) - (misc.amount / misc.batch_size)) / (misc.amount / misc.batch_size) > .05">
                    <i title="The suggested quantity for this ingredient is {{ misc.amount }} {{ misc.amount_label }} per {{ misc.batch_size }}." class="fas fa-exclamation-triangle img-responsive warning"></i>
                  </span>
                  {{ _designer.recipe.recipe_miscellaneous_attributes[i].quantity | number:'1.0-2' }} {{ _designer.recipe.recipe_miscellaneous_attributes[i].quantity_label }}</td>
              </tr>

              <tr *ngFor="let hop of _designer.used_hops; let i = index ">
                <td>{{ hop.name }} ({{ _designer.displayHopInfo(_designer.recipe.recipe_hops_attributes[i].usage, _designer.recipe.recipe_hops_attributes[i].time) }})</td>
                <td>{{ hop.hop_type }}</td>
                <td>{{ _designer.individualIBU(_designer.recipe.recipe_hops_attributes[i], i, _designer.measurement['ibu']) | number:'1.1-1' }} IBUs</td>
                <td>{{ _designer.recipe.recipe_hops_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.hops === 'us' ? "oz" : "g" }}</td>
              </tr>

              <tr *ngFor="let yeast of _designer.used_yeast; let i = index ">
                <td>{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</td>
                <td>Yeast - {{ yeast.form }}</td>
                <!-- <td>{{ _designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1 ? 'Primary' : 'Secondary' }}, {{ _designer.recipe.recipe_yeasts_attributes[i].fermentation_stage === 1 ? _designer.recipe.primary_ferm_temp : _designer.recipe.secondary_ferm_temp }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }}</td> -->
                <td>{{ _designer.recipe.recipe_yeasts_attributes[i].quantity * yeast.cell_count }} billion</td>
                <td>{{ _designer.recipe.recipe_yeasts_attributes[i].quantity | number:'1.0-1' }} pkgs</td>
              </tr>

              <tr *ngFor="let water of _designer.used_waters; let i = index ">
                <td>{{ water.name }}</td>
                <td>Water</td>
                <td>--</td>
                <td>{{ _designer.recipe.recipe_waters_attributes[i].quantity | number:'1.0-1' }} {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}</td>
              </tr>

              <tr *ngFor="let agent of _designer.getActiveAgents()">
                <td>{{ agent.name }}</td>
                <td>Water Agent</td>
                <td>--</td>
                <td>{{ agent.quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "ounces" : "grams" }}</td>
              </tr>

              <tr *ngFor="let acid of _designer.used_acids; let i = index ">
                <td>{{ acid.name }}</td>
                <td>Mash Acid</td>
                <td>--</td>
                <td>{{ _designer.recipe.recipe_acids_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "teaspoons" : "milliliters" }}</td>
              </tr>

              <tr *ngFor="let acid of _designer.used_sparge_acids; let i = index ">
                <td>{{ acid.name }}</td>
                <td>Sparge Acid</td>
                <td>--</td>
                <td>{{ _designer.recipe.recipe_acids_attributes[i].quantity | number:'1.0-1' }} {{ _designer.measurement.agents === 'us' ? "teaspoons" : "milliliters" }}</td>
              </tr>
            </table>
            <div>Total malt: {{ _designer.checkPoundsToGrams(_designer.getTotalMaltWeight(), 'malts') | number:'1.1-2' }} {{ _designer.measurement.malts === 'us' ? 'lbs' : 'kg' }}</div>
            <div>Total hops:
              <span *ngIf="_designer.getTotalHopWeight() > (8 * _designer.inputConversion(_designer.recipe.batch_size, 'liquid') / 5)">
                <i title="It is suggested to use at most {{_designer.checkPoundsToGrams(8, 'hops')}} {{ _designer.measurement.hops === 'us' ? 'oz' : 'g' }} of hops per {{_designer.checkGallonsToLiters(5)}} {{ (_designer.measurement.liquid === 'us' ? 'gallons' : 'liters') }} in the batch ({{8 * _designer.inputConversion(_designer.recipe.batch_size, 'liquid') / 5}} oz)." class="fas fa-exclamation-triangle img-responsive warning"></i>
              </span>{{ _designer.checkPoundsToGrams(_designer.getTotalHopWeight(), 'hops') | number:'1.1-2' }} {{ _designer.measurement.hops === 'us' ? 'oz' : 'g' }}
            </div>
            <div>Total yeast: {{ _designer.getTotalYeast() | number:'1.1-2' }} pkgs - {{ _designer.getTotalYeastCells() | number:'1.1-1' }} billion cells</div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <p><b>Notes</b></p>
          </div>
          <div class="col-12">
            <p>{{ _designer.recipe.notes }}</p>
          </div>

          <div class="col-12">
            <p><b>Description</b></p>
          </div>
          <div class="col-12">
            <p>{{ _designer.recipe.description }}</p>
          </div>

          <div class="col-12">
            <p><b>Taste Notes</b></p>
          </div>
          <div class="col-12">
            <p>{{ _designer.recipe.taste_notes }}</p>
          </div>
        </div>

        <div class="row">
          <div class="col-9">
            <table class="table table-sm table-hover">
              <tr>
                <th></th>
                <th>Current</th>
                <th *ngIf="_designer.used_style"></th>
                <th *ngIf="_designer.used_style">Style</th>
              </tr>

              <tr>
                <th>Original Gravity</th>
                <td>{{ _designer.getEstimatedOG() | number:'1.1-3' }}</td>
                <td *ngIf="_designer.used_style && _designer.getEstimatedOG() >= _designer.used_style.min_og && _designer.getEstimatedOG() <= _designer.used_style.max_og"><i class="fas fa-check correct"></i></td>
                <td *ngIf="_designer.used_style && (_designer.getEstimatedOG() < _designer.used_style.min_og || _designer.getEstimatedOG() > _designer.used_style.max_og)"><i class="fas fa-times-circle error"></i></td>
                <td *ngIf="_designer.used_style">{{ _designer.used_style.min_og }} - {{ _designer.used_style.max_og }}</td>
              </tr>

              <tr>
                <th>Bitterness (IBU)</th>
                <td>{{ _designer.calculateIBU(_designer.measurement.ibu) | number:'1.1-1' }}</td>
                <td *ngIf="_designer.used_style && _designer.calculateIBU(_designer.measurement.ibu) >= _designer.used_style.min_ibu && _designer.calculateIBU(_designer.measurement.ibu) <= _designer.used_style.max_ibu"><i class="fas fa-check correct"></i></td>
                <td *ngIf="_designer.used_style && (_designer.calculateIBU(_designer.measurement.ibu) < _designer.used_style.min_ibu || _designer.calculateIBU(_designer.measurement.ibu) > _designer.used_style.max_ibu)"><i class="fas fa-times-circle error"></i></td>
                <td *ngIf="_designer.used_style"> {{ _designer.used_style.min_ibu }} - {{ _designer.used_style.max_ibu }}</td>
              </tr>

              <tr>
                <th>Color ({{ _designer.getColorString() }})</th>
                <td>{{ _designer.getBeerColorValue() | number:'1.1-1'}}</td>
                <td *ngIf="_designer.used_style && _designer.getBeerColorValue() >= _designer.checkColor(_designer.used_style.min_color) && _designer.getBeerColorValue() <= _designer.checkColor(_designer.used_style.max_color)"><i class="fas fa-check correct"></i></td>
                <td *ngIf="_designer.used_style && (_designer.getBeerColorValue() < _designer.checkColor(_designer.used_style.min_color) || _designer.getBeerColorValue() > _designer.checkColor(_designer.used_style.max_color))"><i class="fas fa-times-circle error"></i></td>
                <td *ngIf="_designer.used_style">{{ _designer.checkColor(_designer.used_style.min_color) | number:'1.0-2' }} - {{ _designer.checkColor(_designer.used_style.max_color) | number:'1.0-2' }}</td>
              </tr>

              <tr>
                <th>Final Gravity (%)</th>
                <td>{{ _designer.getEstimatedFG() | number:'1.1-3' }}</td>
                <td *ngIf="_designer.used_style && _designer.getEstimatedFG() >= _designer.used_style.min_fg && _designer.getEstimatedFG() <= _designer.used_style.max_fg"><i class="fas fa-check correct"></i></td>
                <td *ngIf="_designer.used_style && (_designer.getEstimatedFG() < _designer.used_style.min_fg || _designer.getEstimatedFG() > _designer.used_style.max_fg)"><i class="fas fa-times-circle error"></i></td>
                <td *ngIf="_designer.used_style">{{ _designer.used_style.min_fg }} - {{ _designer.used_style.max_fg }}</td>
              </tr>

              <tr>
                <th>ABV (%)</th>
                <td>{{ _designer.getEstimatedABV() | number:'1.0-1' }}</td>
                <td *ngIf="_designer.used_style && _designer.getEstimatedABV() >= _designer.used_style.min_abv && _designer.getEstimatedABV() <= _designer.used_style.max_abv"><i class="fas fa-check correct"></i></td>
                <td *ngIf="_designer.used_style && (_designer.getEstimatedABV() < _designer.used_style.min_abv || _designer.getEstimatedABV() > _designer.used_style.max_abv)"><i class="fas fa-times-circle error"></i></td>
                <td *ngIf="_designer.used_style">{{ _designer.used_style.min_abv }} - {{ _designer.used_style.max_abv }}</td>
              </tr>

            </table>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <span class="help-icon" title="Note: The ratio here is calculated using raw, unrounded numbers for the purpose of accuracy.">&#9432; </span>
            <span>Bitterness ratio: {{ _designer.calculateIBU(_designer.measurement.ibu) / (_designer.getEstimatedOG() - 1) / 1000 | number:'1.0-3' }} IBU/SG</span>
          </div>
        </div>




        <div class="row">
          <p class="col-12">Batch size: {{ _designer.recipe.batch_size| number:'1.0-1' }} {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}</p>
          <p class="col-12">Estimated {{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }} required: {{ _designer.checkGallonsToLiters(_designer.estimateGallonsNeeded()) | number:'1.0-1' }}</p>
          <p class="col-12">Estimated pre-boil volume: {{ _designer.checkGallonsToLiters(_designer.estimatePreGallons()) | number:'1.0-1' }}</p>
        </div>

        <div class="row">
          <table class="table table-sm table-hover">
            <tr *ngIf="_designer.water_profile_select && _designer.currentWater() && _designer.used_water_profile">
              <th class="text-center"><span class="help-icon" title="{{_designer.agentTitle('main')}}">&#9432; </span></th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('ph')" class="help-icon" title="{{_designer.agentTitle('ph')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('ph')"><i title="{{_designer.agentTitle('ph')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                pH
              </th>
              <th class="text-right">
                <span *ngIf="_designer.currentWater().calcium >= _designer.used_water_profile.calcium_min && _designer.currentWater().calcium <= _designer.used_water_profile.calcium_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.calcium_min }} and {{ _designer.used_water_profile.calcium_max }} ppm.">&#9432; </span>
                <span *ngIf="_designer.currentWater().calcium > _designer.used_water_profile.calcium_max || _designer.currentWater().calcium < _designer.used_water_profile.calcium_min"><i title="{{_designer.agentTitle('ca')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Ca
              </th>
              <th class="text-right">
                <span *ngIf="_designer.currentWater().magnesium >= _designer.used_water_profile.magnesium_min && _designer.currentWater().magnesium <= _designer.used_water_profile.magnesium_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.magnesium_min }} and {{ _designer.used_water_profile.magnesium_max }} ppm.">&#9432; </span>
                <span *ngIf="_designer.currentWater().magnesium > _designer.used_water_profile.magnesium_max || _designer.currentWater().magnesium < _designer.used_water_profile.magnesium_min"><i title="{{_designer.agentTitle('mg')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Mg
              </th>
              <th class="text-right">
                <span *ngIf="_designer.currentWater().sodium >= 0 && _designer.currentWater().sodium <= 150" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between 0 and 150 ppm.">&#9432; </span>
                <span *ngIf="_designer.currentWater().sodium > 150 || _designer.currentWater().sodium < 0"><i title="{{_designer.agentTitle('na')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Na
              </th>
              <th class="text-right">
                <span *ngIf="_designer.currentWater().sulfate >= _designer.used_water_profile.sulfate_min && _designer.currentWater().sulfate <= _designer.used_water_profile.sulfate_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.sulfate_min }} and {{ _designer.used_water_profile.sulfate_max }} ppm.">&#9432; </span>
                <span *ngIf="_designer.currentWater().sulfate > _designer.used_water_profile.sulfate_max || _designer.currentWater().sulfate < _designer.used_water_profile.sulfate_min"><i title="{{_designer.agentTitle('so4')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                SO4
              </th>
              <th class="text-right">
                <span *ngIf="_designer.currentWater().chloride >= _designer.used_water_profile.chloride_min && _designer.currentWater().chloride <= _designer.used_water_profile.chloride_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.chloride_min }} and {{ _designer.used_water_profile.chloride_max }} ppm.">&#9432; </span>
                <span *ngIf="_designer.currentWater().chloride > _designer.used_water_profile.chloride_max || _designer.currentWater().chloride < _designer.used_water_profile.chloride_min"><i title="{{_designer.agentTitle('cl')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Cl
              </th>
              <th class="text-right">
                <span *ngIf="_designer.currentWater().bicarbonate >= _designer.used_water_profile.alkalinity_min && _designer.currentWater().bicarbonate <= _designer.used_water_profile.alkalinity_max" class="help-icon" title="{{_designer.agentTitle('ca')}}\n\nThe desired quantity for the current profile is between {{ _designer.used_water_profile.alkalinity_min }} and {{ _designer.used_water_profile.alkalinity_max }} ppm.">&#9432; </span>
                <span *ngIf="_designer.currentWater().bicarbonate > _designer.used_water_profile.alkalinity_max || _designer.currentWater().bicarbonate < _designer.used_water_profile.alkalinity_min"><i title="{{_designer.agentTitle('hco3')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                HCO3
              </th>
            </tr>
            <tr *ngIf="!_designer.water_profile_select">
              <th class="text-center"><span class="help-icon" title="{{_designer.agentTitle('main')}}">&#9432; </span></th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('ph')" class="help-icon" title="{{_designer.agentTitle('ph')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('ph')"><i title="{{_designer.agentTitle('ph')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                pH
              </th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('ca')" class="help-icon" title="{{_designer.agentTitle('ca')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('ca')"><i title="{{_designer.agentTitle('ca')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Ca
              </th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('mg')" class="help-icon" title="{{_designer.agentTitle('mg')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('mg')" [ngClass]="{'error': (_designer.currentWater() && _designer.currentWater().magnesium >= 125), 'warning': (_designer.currentWater() && _designer.currentWater().magnesium < 125)}"><i title="{{_designer.agentTitle('mg')}}" class="fas fa-exclamation-triangle img-responsive"></i></span>
                Mg
              </th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('na')" class="help-icon" title="{{_designer.agentTitle('na')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('na')"><i title="{{_designer.agentTitle('na')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Na
              </th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('so4')" class="help-icon" title="{{_designer.agentTitle('so4')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('so4')"><i title="{{_designer.agentTitle('so4')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                SO4
              </th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('cl')" class="help-icon" title="{{_designer.agentTitle('cl')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('cl')"><i title="{{_designer.agentTitle('cl')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                Cl
              </th>
              <th class="text-right">
                <span *ngIf="_designer.agentPortion('hco3')" class="help-icon" title="{{_designer.agentTitle('hco3')}}">&#9432; </span>
                <span *ngIf="!_designer.agentPortion('hco3')"><i title="{{_designer.agentTitle('hco3')}}" class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                HCO3
              </th>
            </tr>
            <tr>
              <td>Current Water</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().ph.toFixed(1) : '--'}}</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().calcium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().magnesium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().sodium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().sulfate.toFixed(1) : '--'}}</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().chloride.toFixed(1) : '--'}}</td>
              <td class="text-right">{{(_designer.currentWater() && _designer.addWaterGallons() !== 0) ? _designer.currentWater().bicarbonate.toFixed(1) : '--'}}</td>
            </tr>
            <tr *ngIf="!_designer.water_profile_select">
              <td>Target Water</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.ph.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.calcium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.magnesium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.sodium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.sulfate.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.chloride.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.target_water ? _designer.target_water.bicarbonate.toFixed(1) : '--'}}</td>
            </tr>
            <tr class="difference" *ngIf="!_designer.water_profile_select">
              <td>Difference</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().ph.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().calcium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().magnesium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().sodium.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().sulfate.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().chloride.toFixed(1) : '--'}}</td>
              <td class="text-right">{{_designer.waterDifference() ? _designer.waterDifference().bicarbonate.toFixed(1) : '--'}}</td>
            </tr>
          </table>
        </div>

        <div class="row" *ngIf="_designer.used_water_profile && _designer.used_waters[0] && _designer.water_profile_select">
          <app-radar-chart [canvas_id]="'profileChartPdf'" [boundary]="_designer.used_water_profile" [current_water]="_designer.currentWater()"></app-radar-chart>
        </div>
        <div class="row">

          <div class="col-4" *ngIf="!_designer.water_profile_select">
            <div class="container">
              <div class="row">
                <div class="col-12">

                  <span *ngIf="_designer.ra >= -60 && _designer.ra <= 200" class="help-icon" title="RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200.">&#9432; </span>
                  <span *ngIf="_designer.ra < -60 || _designer.ra > 200"><i title="RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200." class="fas fa-exclamation-triangle img-responsive warning"></i></span>

                  <label for="ra_slider">RA:</label>
                  <label for="ra_slider">{{ _designer.ra }}</label>
                </div>
                <div class="col-12 slider-div">
                  <input id="ra_slider" type="range" min="-60" max="200" [disabled]='true' class="slider helper-icon" [value]="_designer.ra" step="1">
                </div>
              </div>
            </div>
          </div>
          <div class="col-4" *ngIf="_designer.water_profile_select">
            <div class="container">
              <div class="row">
                <div class="col-12">

                  <span *ngIf="_designer.ra >= _designer.used_water_profile.ra_min && _designer.ra <= _designer.used_water_profile.ra_max" class="help-icon" title="The desired RA range for this profile is {{ _designer.used_water_profile.ra_min }} to {{ _designer.used_water_profile.ra_max }}.\n\nRA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200.">&#9432; </span>
                  <span *ngIf="_designer.ra < _designer.used_water_profile.ra_min || _designer.ra > _designer.used_water_profile.ra_max"><i title="The desired RA range for this profile is {{ _designer.used_water_profile.ra_min }} to {{ _designer.used_water_profile.ra_max }}.&#013;&#013;RA is the amount of alkalinity left after a chemical reaction occurs between calcium, magnesium and malt phosphate. A positive value results in a higher mash pH, while a negative value results in a lower mash pH. Typical values lie in the range of -60 to 200." class="fas fa-exclamation-triangle img-responsive warning"></i></span>

                  <label for="ra_slider">RA:</label>
                  <label for="ra_slider">{{ _designer.ra }}</label>
                </div>
                <div class="col-12 slider-div">
                  <input id="ra_slider" type="range" min="-60" max="200" [disabled]='true' class="slider helper-icon" [value]="_designer.ra" step="1">
                </div>
              </div>
            </div>
          </div>

          <div class="col-4">
            <div class="container">
              <div class="row">
                <div class="col-12">

                  <span *ngIf="_designer.so4_cl_ratio >= 0.5 && _designer.so4_cl_ratio <= 9" class="help-icon" title="The ratio of sulfate to chloride effects the maltiness of the beer. A ratio less than 1 will accentuate the maltiness, while a ratio greater than 1 will accentuate bitterness. The typical range for this ratio is from 0.5 to 9, however it only really has an effect with ppms greater than 50.">&#9432; </span>
                  <span *ngIf="(_designer.so4_cl_ratio < 0.5 || _designer.so4_cl_ratio > 9) && (_designer.currentWater().sulfate + _designer.currentWater().chloride > 50)"><i title="The ratio of sulfate to chloride effects the maltiness of the beer. A ratio less than 1 will accentuate the maltiness, while a ratio greater than 1 will accentuate bitterness. The typical range for this ratio is from 0.5 to 9, however it only really has an effect with ppms greater than 50." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                  <label for="so4cl-slider">SO4:Cl</label>
                  <label for="so4cl-slider">{{ _designer.so4_cl_ratio }}</label>
                </div>
                <div class="col-12 slider-div">
                  <input id="so4cl-slider" type="range" min=".5" max="9" [disabled]='true' class="slider helper-icon" [value]="_designer.so4_cl_ratio" step=".1">
                </div>
              </div>
            </div>
          </div>

          <div class="col-4">
            <div class="container">
              <div class="row">
                <div class="col-12">
                  <span *ngIf="_designer.getEstimatedPh() > 5.6 || _designer.getEstimatedPh() < 5.2"><i title="Mash pH should be between 5.2 and 5.6 in order to promote maximum enzyme efficiency and improve potential yeast health. Check the pH 10-15 minutes into the mash on a room temperature sample." class="fas fa-exclamation-triangle img-responsive warning"></i></span>
                  <label for="mashph-slider">Mash pH:</label>
                  <label for="mashph-slider">{{ _designer.getEstimatedPh() | number:'1.1-2' }}</label>
                </div>
                <div class="col-12 slider-div">
                  <input id="mashph-slider" type="range" min="5.2" max="5.6" [disabled]='true' class="slider helper-icon" [value]="_designer.getEstimatedPh()" step=".05">
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <p><b>Mash</b></p>
          </div>

          <div class="col-12">
            <p>Sparge strategy: {{ _designer.getSpargeType() }}</p>
            <p>Sparge quantity ({{ (_designer.measurement.liquid === 'us' ? "gallons" : "liters") }}): {{ _designer.checkGallonsToLiters(_designer.getMashWaterInfo()["sparge_amount"]) | number:'1.1-2' }}</p>
          </div>

          <div class="col-12">
            <p>Mash type: {{ _designer.getMashType() }}</p>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <p><b>Mash Steps</b></p>
          </div>
          <div class="col-12" *ngIf="_designer.getUsedMashSteps().length === 0">
            <p><b>No mash steps have been added.</b></p>
          </div>
          <div class="col-12" *ngIf="_designer.getUsedMashSteps().length > 0">
            <table class="table table-sm table-hover">
              <tr>
                <th>Name</th>
                <th>Step Temp (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</th>
                <th>Time (min)</th>
                <th *ngIf='_designer.recipe.mash_type !== "decoction"'>Water Addition Amount ({{(_designer.measurement.liquid === 'us' ? "quarts" : "liters")}})</th>
                <th *ngIf='_designer.recipe.mash_type === "decoction"'>Water Addition Amount ({{(_designer.measurement.liquid === 'us' ? "quarts/% mash" : "liters/% mash")}})</th>
                <th>Water Addition Temp (&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }})</th>
              </tr>
              <tr *ngFor="let step of _designer.getMashWaterInfo()['step_info']; let i = index ">
                <td><span *ngIf="step.step_name === 'Steeping'" class="help-icon" title="Steeping is done with extract brewing, generally beginning when the water temperature reaches 140 degrees, and lasting for about 20 minutes as the temperature reaches 170 degrees.">&#9432; </span>{{ step.step_name }}</td>
                <td>{{ _designer.checkFahrenheitToCelsius(step.step_temp) | number:'1.1-2' }}</td>
                <td>{{ step.step_time }}</td>
                <td *ngIf="i === 0 || _designer.recipe.mash_type !== 'decoction'">{{ step.water_amount | number:'1.1-2' }}</td>
                <td *ngIf="i !== 0 && _designer.recipe.mash_type === 'decoction'">{{ step.water_amount | number:'1.1-1' }}%</td>
                <td>{{ _designer.checkFahrenheitToCelsius(step.water_temp) | number:'1.1-2' }}</td>
              </tr>
            </table>
          </div>
        </div>

        <div class="row">
          <div class="col-12">
            <p><b>Yeast</b></p>
          </div>

          <div class="col-12">
            <p>Finish strategy: {{ _designer.recipe.storage_type }} at {{ _designer.recipe.storage_temperature | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} with {{ _designer.recipe.carbonation_with }} ({{ _designer.getVolumesQuantity() | number:'1.1-2' }} {{ _designer.volumesLabel() }})</p>
          </div>

          <div class="col-12">
            <p>Primary fermentation: {{ _designer.recipe.primary_ferm_temp | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} for {{ _designer.recipe.primary_ferm_days }} days</p>
            <ul>
              <li *ngFor="let yeast of _designer.getUsedYeast(1)">{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</li>
            </ul>
          </div>

          <div class="col-12" *ngIf="_designer.recipe.secondary_fermentation">
            <p>Secondary fermentation: {{ _designer.recipe.secondary_ferm_temp | number:'1.0-1' }}&deg;{{ _designer.measurement.temperature === 'us' ? 'F' : 'C' }} for {{ _designer.recipe.secondary_ferm_days }} days</p>
            <ul>
              <li *ngFor="let yeast of _designer.getUsedYeast(2)">{{ yeast.name }}{{ yeast.lab ? " - " + yeast.lab : "" }}</li>
            </ul>
          </div>
        </div>

      </div>
    </div>
  </div>
</ng-template>

<ng-template #runnerPopup let-c="close" let-d="dismiss">
  <button type="button" class="runner-close float-right" aria-label="Close" (click)="d('Cross click')">
    <span aria-hidden="true">&times;</span>
  </button>
  <app-recipe-runner [startingStep]="runner_step" (onFinish)="d('Cross click')"></app-recipe-runner>
</ng-template>

<ng-template #importXmlPopup let-c="close" let-d="dismiss">
  <div class="modal-header">
    <h4 class="modal-title">Upload XML to Import</h4>
    <button type="button" class="close" aria-label="Close" (click)="d('Cross click')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>
  <div class="modal-body">
    <div class="container">
      <div class="row">
        <div class="col-12 pad-bottom">
          <label for="filename">Choose File</label>
          <input type="file" id="filename" (change)="handleFileInput($event.target.files)">
        </div>
        <div class="col-12">
          <button (click)="importXml()" class="btn btn-primary">Import</button>
          <button type="button" class="btn btn-default" (click)="c('Close click')">Cancel</button>
        </div>
      </div>
    </div>
  </div>
</ng-template>

<ng-template #styleDetailPopup let-c="close" let-d="dismiss">
  <app-style-card [style]="_designer.used_style"></app-style-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #equipmentDetailPopup let-c="close" let-d="dismiss">
  <app-equipment-card [equipment]="_designer.used_equipment"></app-equipment-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #hopDetailPopup let-c="close" let-d="dismiss">
  <app-hop-card [hop]="_designer.used_hops[_designer.detailIndex]"></app-hop-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #yeastDetailPopup let-c="close" let-d="dismiss">
  <app-yeast-card [yeast]="_designer.used_yeast[_designer.detailIndex]"></app-yeast-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #maltDetailPopup let-c="close" let-d="dismiss">
  <app-malt-card [malt]="_designer.used_malts[_designer.detailIndex]"></app-malt-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #miscDetailPopup let-c="close" let-d="dismiss">
  <app-miscellaneous-card [miscellaneous]="_designer.used_miscellaneous[_designer.detailIndex]"></app-miscellaneous-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #waterDetailPopup let-c="close" let-d="dismiss">
  <app-water-card [profile]="_designer.used_waters[_designer.detailIndex]"></app-water-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #targetWaterDetailPopup let-c="close" let-d="dismiss">
  <app-water-card [profile]="_designer.target_water"></app-water-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>

<ng-template #agentDetailPopup let-c="close" let-d="dismiss">
  <app-agent-card [agent]="_designer.agents[_designer.detailIndex]"></app-agent-card>
  <div class="col-12">
    <button type="button" class="btn btn-primary float-right margin-full" (click)="c('Close click')">Close</button>
  </div>
</ng-template>
